<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deutschland im Gleichgewicht</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&family=Exo+2:wght@300;400;600;800&display=swap');

  :root {
    --bg: #080c14;
    --bg2: #0d1420;
    --bg3: #111927;
    --glass: rgba(255,255,255,0.04);
    --glass2: rgba(255,255,255,0.07);
    --border: rgba(255,255,255,0.08);
    --border2: rgba(255,255,255,0.14);
    --neon-blue: #00d4ff;
    --neon-green: #00ff9d;
    --neon-red: #ff3366;
    --neon-amber: #ffb800;
    --neon-purple: #c77dff;
    --text: #e8edf5;
    --text2: #8fa0b8;
    --text3: #556070;
    --gov-color: #4fc3f7;
    --biz-color: #ffd54f;
    --hh-color: #81c784;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Exo 2', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 80% 60% at 20% -10%, rgba(0,100,200,0.12) 0%, transparent 60%),
      radial-gradient(ellipse 60% 50% at 80% 110%, rgba(0,200,120,0.08) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }

  .screen { display: none; position: fixed; inset: 0; z-index: 100; overflow-y: auto; }
  .screen.active { display: flex; }

  /* ‚îÄ‚îÄ TUTORIAL SCREEN ‚îÄ‚îÄ */
  #tutorialScreen {
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: var(--bg);
    padding: 2rem 1rem;
  }
  #tutorialScreen::before {
    content:''; position:absolute; inset:0;
    background: radial-gradient(ellipse 70% 60% at 50% 50%, rgba(0,180,255,0.07) 0%, transparent 70%);
    pointer-events:none;
  }
  .tut-container {
    max-width: 680px;
    width: 100%;
    position: relative;
    z-index:1;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }
  .tut-logo {
    text-align: center;
  }
  .tut-logo h1 {
    font-family: 'Rajdhani', sans-serif;
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: 700;
    background: linear-gradient(135deg, var(--neon-blue), var(--neon-green));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.1;
    margin-bottom: 0.3rem;
  }
  .tut-logo p {
    color: var(--text3);
    font-size: 0.78rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
  }

  /* 4-step flow */
  .tut-flow {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.6rem;
  }
  @media(max-width:640px){ .tut-flow { grid-template-columns: repeat(2,1fr); } }
  .tut-step {
    background: var(--glass2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1rem 0.85rem;
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
  }
  .tut-step-icon { font-size: 1.6rem; line-height: 1; }
  .tut-step-num  { font-family:'Share Tech Mono',monospace; font-size:0.6rem; color:var(--neon-blue); letter-spacing:0.1em; }
  .tut-step-title{ font-family:'Rajdhani',sans-serif; font-size:0.95rem; font-weight:700; color:var(--text); }
  .tut-step-text { font-size:0.73rem; color:var(--text2); line-height:1.5; }

  /* glossary ‚Äì compact pill layout */
  .glossary-pills {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  .glos-pill {
    background: var(--glass2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.4rem 0.7rem;
    cursor: default;
    position: relative;
  }
  .glos-pill-term {
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--text);
  }
  .glos-pill-def {
    display: none;
    position: absolute;
    bottom: calc(100% + 6px);
    left: 0;
    min-width: 200px;
    max-width: 260px;
    background: rgba(10,18,30,.97);
    border: 1px solid var(--border2);
    border-radius: 8px;
    padding: 0.5rem 0.7rem;
    font-size: 0.71rem;
    color: var(--text2);
    line-height: 1.5;
    z-index: 300;
    white-space: normal;
    pointer-events: none;
  }
  .glos-pill:hover .glos-pill-def { display: block; }
  .glos-section-label {
    font-family:'Share Tech Mono',monospace; font-size:0.65rem;
    color:var(--text3); letter-spacing:0.1em; text-transform:uppercase;
    margin-bottom:0.5rem;
  }

  .tut-btn-row {
    display: flex;
    gap: 0.75rem;
    justify-content: center;
  }

  /* ‚îÄ‚îÄ INTRO/ROLE SCREEN ‚îÄ‚îÄ */
  #introScreen {
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: var(--bg);
    padding: 2rem 1rem;
  }
  #introScreen::before {
    content:''; position:absolute; inset:0;
    background: radial-gradient(ellipse 70% 60% at 50% 50%, rgba(0,180,255,0.07) 0%, transparent 70%);
    pointer-events:none;
  }
  .intro-logo {
    font-family: 'Rajdhani', sans-serif;
    font-size: clamp(1.5rem, 3.5vw, 2.2rem);
    font-weight: 700;
    text-align: center;
    color: var(--text);
    margin-bottom: 0.2rem;
    position: relative; z-index:1;
  }
  .intro-sub {
    color: var(--text3);
    font-size: 0.72rem;
    text-align: center;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    margin-bottom: 1.8rem;
    position: relative; z-index:1;
  }
  .role-select-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1rem;
    width: 100%;
    max-width: 860px;
    position: relative; z-index:1;
  }
  .role-card {
    background: var(--glass);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 1.4rem;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }
  .role-card::before {
    content:''; position:absolute; inset:0; opacity:0;
    transition:opacity 0.3s; border-radius:14px;
  }
  .role-card[data-role="gov"]::before { background: radial-gradient(circle at 50% 0%, rgba(79,195,247,0.12), transparent 70%); }
  .role-card[data-role="biz"]::before { background: radial-gradient(circle at 50% 0%, rgba(255,213,79,0.12), transparent 70%); }
  .role-card[data-role="hh"]::before  { background: radial-gradient(circle at 50% 0%, rgba(129,199,132,0.12), transparent 70%); }
  .role-card:hover { transform:translateY(-3px); }
  .role-card:hover::before { opacity:1; }
  .role-card[data-role="gov"]:hover { box-shadow:0 6px 28px rgba(79,195,247,0.15); border-color:rgba(79,195,247,0.35); }
  .role-card[data-role="biz"]:hover { box-shadow:0 6px 28px rgba(255,213,79,0.15);  border-color:rgba(255,213,79,0.35); }
  .role-card[data-role="hh"]:hover  { box-shadow:0 6px 28px rgba(129,199,132,0.15); border-color:rgba(129,199,132,0.35); }

  .role-card-top { display:flex; align-items:center; gap:0.6rem; }
  .role-emoji    { font-size:1.8rem; flex-shrink:0; }
  .role-name     { font-family:'Rajdhani',sans-serif; font-size:1.15rem; font-weight:700; }
  .role-card[data-role="gov"] .role-name { color:var(--gov-color); }
  .role-card[data-role="biz"] .role-name { color:var(--biz-color); }
  .role-card[data-role="hh"]  .role-name { color:var(--hh-color); }
  .role-alias { font-size:0.68rem; color:var(--text3); }
  .role-desc  { font-size:0.78rem; color:var(--text2); line-height:1.5; }

  .role-goals {
    display:flex; flex-direction:column; gap:0.2rem;
    padding-top:0.5rem; border-top:1px solid var(--border);
    margin-top:0.2rem;
  }
  .role-goal-item {
    font-size:0.7rem; color:var(--text2);
    font-family:'Share Tech Mono',monospace;
    display:flex; align-items:center; gap:0.4rem;
  }

  .difficulty-badge {
    position:absolute; top:10px; right:10px;
    font-size:0.58rem; letter-spacing:0.08em;
    padding:0.15rem 0.4rem; border-radius:4px; font-weight:700;
  }
  .diff-easy   { background:rgba(0,255,157,.15); color:var(--neon-green); border:1px solid rgba(0,255,157,.3); }
  .diff-medium { background:rgba(255,184,0,.15);  color:var(--neon-amber); border:1px solid rgba(255,184,0,.3); }
  .diff-hard   { background:rgba(255,51,102,.15); color:var(--neon-red);   border:1px solid rgba(255,51,102,.3); }

  /* ‚îÄ‚îÄ GAME SCREEN ‚îÄ‚îÄ */
  #gameScreen {
    flex-direction: column;
    overflow-y: auto;
    position: relative;
  }

  .game-header {
    position: sticky;
    top: 0;
    z-index: 50;
    background: rgba(8,12,20,0.92);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border);
    padding: 0.65rem 1.2rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
  }
  .header-title {
    font-family: 'Rajdhani', sans-serif;
    font-size: 1.3rem;
    font-weight: 700;
    background: linear-gradient(135deg, var(--neon-blue), var(--neon-green));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text;
    white-space: nowrap;
  }
  .header-sep { flex: 1; }
  .round-badge {
    background: var(--glass2);
    border: 1px solid var(--border2);
    border-radius: 8px;
    padding: 0.3rem 0.75rem;
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.82rem;
    color: var(--neon-blue);
    white-space: nowrap;
  }
  .stability-badge {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    background: var(--glass2);
    border: 1px solid var(--border2);
    border-radius: 8px;
    padding: 0.3rem 0.75rem;
    font-family: 'Share Tech Mono', monospace;
    font-size: 0.82rem;
    white-space: nowrap;
    cursor: help;
    position: relative;
  }
  .stability-badge:hover .stab-tooltip { opacity:1; pointer-events:auto; }
  .stab-tooltip {
    position:absolute; top:calc(100% + 8px); right:0;
    background: rgba(10,18,30,0.97);
    border:1px solid var(--border2);
    border-radius:8px;
    padding:0.6rem 0.8rem;
    font-size:0.72rem; color:var(--text);
    white-space:nowrap; opacity:0; pointer-events:none;
    transition:opacity 0.2s; z-index:300;
    min-width:220px;
  }
  .stab-dot {
    width:8px; height:8px;
    border-radius:50%;
    background: var(--neon-green);
    box-shadow: 0 0 6px var(--neon-green);
    animation: pulse 2s infinite;
  }
  .stab-dot.warn { background: var(--neon-amber); box-shadow: 0 0 6px var(--neon-amber); }
  .stab-dot.danger { background: var(--neon-red); box-shadow: 0 0 6px var(--neon-red); }
  @keyframes pulse { 0%,100%{opacity:1}50%{opacity:.4} }
  .role-indicator {
    font-size:0.78rem; padding:0.3rem 0.75rem;
    border-radius:8px; font-weight:600; white-space:nowrap;
  }
  .role-indicator.gov { background:rgba(79,195,247,.15); color:var(--gov-color); border:1px solid rgba(79,195,247,.3); }
  .role-indicator.biz { background:rgba(255,213,79,.15);  color:var(--biz-color); border:1px solid rgba(255,213,79,.3); }
  .role-indicator.hh  { background:rgba(129,199,132,.15); color:var(--hh-color);  border:1px solid rgba(129,199,132,.3); }

  .help-btn {
    background: var(--glass2); border: 1px solid var(--border2);
    border-radius:8px; padding:0.3rem 0.6rem; font-size:0.8rem;
    color:var(--text2); cursor:pointer;
    transition:all 0.2s;
  }
  .help-btn:hover { color:var(--text); border-color:var(--neon-blue); }

  /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
  .game-main {
    display: grid;
    grid-template-columns: 270px 1fr 270px;
    gap: 0.9rem;
    padding: 0.9rem 1.2rem;
    position: relative;
    z-index: 1;
    min-height: calc(100vh - 58px);
  }
  @media (max-width: 1100px) {
    .game-main { grid-template-columns: 1fr; }
  }

  .panel {
    background: var(--glass);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 1rem;
    position: relative;
    overflow: hidden;
  }
  .panel-title {
    font-family: 'Rajdhani', sans-serif;
    font-size: 0.72rem;
    font-weight: 600;
    letter-spacing: 0.15em;
    color: var(--text3);
    text-transform: uppercase;
    margin-bottom: 0.9rem;
    display: flex; align-items:center; gap:0.5rem;
  }

  /* ‚îÄ‚îÄ KPI ‚îÄ‚îÄ */
  .kpi-grid { display:flex; flex-direction:column; gap:0.65rem; }
  .kpi-card {
    background: var(--glass2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 0.7rem;
    transition: border-color 0.3s;
    position:relative;
  }
  .kpi-card:hover { border-color: var(--border2); }
  .kpi-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:0.4rem; }
  .kpi-name { font-size:0.78rem; color:var(--text2); font-weight:600; letter-spacing:0.04em; display:flex; align-items:center; gap:0.35rem; }
  .kpi-value { font-family:'Share Tech Mono',monospace; font-size:1.05rem; font-weight:700; }
  .kpi-delta { font-family:'Share Tech Mono',monospace; font-size:0.7rem; padding:0.1rem 0.3rem; border-radius:4px; margin-left:0.25rem; }
  .kpi-delta.pos { background:rgba(0,255,157,.15); color:var(--neon-green); }
  .kpi-delta.neg { background:rgba(255,51,102,.15); color:var(--neon-red); }
  .kpi-delta.neu { background:rgba(255,255,255,.07); color:var(--text3); }
  .kpi-bar-bg { height:5px; background:rgba(255,255,255,.07); border-radius:4px; overflow:hidden; }
  .kpi-bar { height:100%; border-radius:4px; transition:width 0.8s cubic-bezier(.4,0,.2,1); }
  .kpi-tooltip {
    display:none; position:absolute; bottom:calc(100% + 6px); left:0; right:0;
    background:rgba(10,18,30,.97); border:1px solid var(--border2);
    border-radius:8px; padding:0.5rem 0.7rem; font-size:0.72rem; color:var(--text);
    z-index:200; line-height:1.5;
  }
  .kpi-card:hover .kpi-tooltip { display:block; }

  /* color classes */
  .c-employment { color:var(--neon-green); }
  .c-gdp        { color:var(--neon-blue);  }
  .c-inflation  { color:var(--neon-amber); }
  .c-budget     { color:var(--neon-purple);}
  .c-hh         { color:var(--hh-color);   }
  .c-biz        { color:var(--biz-color);  }
  .c-gov        { color:var(--gov-color);  }

  .bar-employment { background:linear-gradient(90deg,#00ff9d88,var(--neon-green)); }
  .bar-gdp        { background:linear-gradient(90deg,#00d4ff88,var(--neon-blue)); }
  .bar-inflation  { background:linear-gradient(90deg,#ffb80088,var(--neon-amber)); }
  .bar-budget     { background:linear-gradient(90deg,#c77dff88,var(--neon-purple)); }
  .bar-hh         { background:linear-gradient(90deg,rgba(129,199,132,.5),var(--hh-color)); }
  .bar-biz        { background:linear-gradient(90deg,rgba(255,213,79,.5),var(--biz-color)); }
  .bar-gov        { background:linear-gradient(90deg,rgba(79,195,247,.5),var(--gov-color)); }
  .bar-kaufkraft  { background:linear-gradient(90deg,rgba(168,230,207,.5),#a8e6cf); }

  /* val states */
  .val-danger { color: var(--neon-red) !important; }
  .val-warn   { color: var(--neon-amber) !important; }
  .val-ok     { }

  /* ‚îÄ‚îÄ EVENT ‚îÄ‚îÄ */
  .event-card {
    background:linear-gradient(135deg,rgba(255,255,255,.06),rgba(255,255,255,.02));
    border:1px solid var(--border2);
    border-radius:14px; padding:1.4rem;
    margin-bottom:1rem; position:relative; overflow:hidden;
  }
  .event-card::before {
    content:''; position:absolute; top:0; left:0; right:0; height:3px;
    background:linear-gradient(90deg,var(--neon-blue),var(--neon-green));
  }
  .event-tag { font-size:0.68rem; letter-spacing:0.14em; color:var(--neon-blue); text-transform:uppercase; font-weight:700; margin-bottom:0.4rem; }
  .event-title { font-family:'Rajdhani',sans-serif; font-size:1.5rem; font-weight:700; margin-bottom:0.5rem; display:flex; align-items:center; gap:0.5rem; flex-wrap:wrap; }
  .event-desc { color:var(--text2); font-size:0.87rem; line-height:1.65; margin-bottom:0.75rem; }
  .event-impact {
    display:flex; gap:0.4rem; flex-wrap:wrap; margin-top:0.5rem;
    padding-top:0.6rem; border-top:1px solid var(--border);
  }
  .impact-chip {
    font-size:0.65rem; padding:0.15rem 0.45rem; border-radius:4px;
    font-family:'Share Tech Mono',monospace; white-space:nowrap;
  }
  .impact-neg { background:rgba(255,51,102,.12); color:#ff7096; border:1px solid rgba(255,51,102,.25); }
  .impact-pos { background:rgba(0,255,157,.12); color:#00ff9d; border:1px solid rgba(0,255,157,.25); }
  .impact-neu { background:rgba(255,255,255,.06); color:var(--text3); border:1px solid var(--border); }

  /* ‚îÄ‚îÄ DECISIONS ‚îÄ‚îÄ */
  .decisions-label {
    font-family:'Rajdhani',sans-serif; font-size:0.72rem; font-weight:600;
    letter-spacing:0.14em; color:var(--text3); text-transform:uppercase;
    margin-bottom:0.5rem; display:flex; align-items:center; gap:0.5rem;
  }
  .decisions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 0.7rem;
    margin-bottom: 1rem;
  }
  .decision-card {
    background: var(--glass);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.22s ease;
    position: relative;
    overflow: hidden;
  }
  .decision-card::before {
    content:''; position:absolute; inset:0;
    background:linear-gradient(135deg,rgba(255,255,255,.04),transparent);
    opacity:0; transition:opacity 0.22s;
  }
  .decision-card:hover { transform:translateY(-2px); border-color:var(--neon-blue); box-shadow:0 4px 20px rgba(0,212,255,.15); }
  .decision-card:hover::before { opacity:1; }
  .decision-card:active { transform:translateY(0) scale(.98); }
  .decision-card.selected { border-color:var(--neon-green); box-shadow:0 4px 20px rgba(0,255,157,.2); background:rgba(0,255,157,.04); }
  .decision-card.disabled { opacity:.4; pointer-events:none; }
  .decision-emoji { font-size:1.5rem; margin-bottom:0.4rem; display:block; }
  .decision-title { font-family:'Rajdhani',sans-serif; font-size:1rem; font-weight:600; margin-bottom:0.4rem; line-height:1.3; }
  .decision-desc  { font-size:0.72rem; color:var(--text3); margin-bottom:0.4rem; line-height:1.4; }
  .effect-chips   { display:flex; flex-wrap:wrap; gap:0.25rem; margin-top:0.4rem; }
  .chip { font-size:0.62rem; padding:0.12rem 0.35rem; border-radius:4px; font-family:'Share Tech Mono',monospace; white-space:nowrap; }
  .chip.pro  { background:rgba(0,255,157,.12); color:#00ff9d; border:1px solid rgba(0,255,157,.25); }
  .chip.con  { background:rgba(255,51,102,.12); color:#ff7096; border:1px solid rgba(255,51,102,.25); }
  .chip.neu  { background:rgba(255,255,255,.06); color:var(--text3); border:1px solid var(--border); }
  .tradeoff-badge {
    font-size:0.6rem; font-family:'Share Tech Mono',monospace;
    background:rgba(255,184,0,.12); color:var(--neon-amber);
    border:1px solid rgba(255,184,0,.3);
    border-radius:4px; padding:0.15rem 0.4rem;
    position:absolute; top:8px; right:8px;
  }

  /* ‚îÄ‚îÄ ACTOR CARDS ‚îÄ‚îÄ */
  .actor-card {
    background:var(--glass); border:1px solid var(--border);
    border-radius:12px; padding:0.9rem; margin-bottom:0.65rem;
    transition:border-color 0.3s; position:relative; overflow:hidden;
  }
  .actor-card.gov { border-left:3px solid var(--gov-color); }
  .actor-card.biz { border-left:3px solid var(--biz-color); }
  .actor-card.hh  { border-left:3px solid var(--hh-color); }
  .actor-card.is-player.gov { border-color:rgba(79,195,247,.4) rgba(79,195,247,.15) rgba(79,195,247,.15) var(--gov-color); border-style:solid; border-width:1px 1px 1px 3px; }
  .actor-card.is-player.biz { border-color:rgba(255,213,79,.4) rgba(255,213,79,.15) rgba(255,213,79,.15) var(--biz-color); border-style:solid; border-width:1px 1px 1px 3px; }
  .actor-card.is-player.hh  { border-color:rgba(129,199,132,.4) rgba(129,199,132,.15) rgba(129,199,132,.15) var(--hh-color); border-style:solid; border-width:1px 1px 1px 3px; }
  .actor-header { display:flex; align-items:center; gap:0.55rem; margin-bottom:0.65rem; }
  .actor-emoji  { font-size:1.4rem; }
  .actor-info   { flex:1; }
  .actor-name   { font-family:'Rajdhani',sans-serif; font-size:0.95rem; font-weight:700; line-height:1.2; }
  .actor-role   { font-size:0.68rem; color:var(--text3); }
  .player-tag   { font-size:0.6rem; background:rgba(0,255,157,.15); color:var(--neon-green); border:1px solid rgba(0,255,157,.3); border-radius:4px; padding:0.1rem 0.35rem; font-weight:700; }
  .happy-row    { display:flex; justify-content:space-between; align-items:center; margin-bottom:0.35rem; }
  .happy-label  { font-size:0.7rem; color:var(--text3); }
  .happy-val    { font-family:'Share Tech Mono',monospace; font-size:0.82rem; font-weight:700; }
  .happy-bar-bg { height:5px; background:rgba(255,255,255,.06); border-radius:4px; overflow:hidden; margin-bottom:0.65rem; }
  .happy-bar    { height:100%; border-radius:4px; transition:width 0.8s cubic-bezier(.4,0,.2,1); }
  .happy-bar.gov { background:linear-gradient(90deg,rgba(79,195,247,.5),var(--gov-color)); }
  .happy-bar.biz { background:linear-gradient(90deg,rgba(255,213,79,.5),var(--biz-color)); }
  .happy-bar.hh  { background:linear-gradient(90deg,rgba(129,199,132,.5),var(--hh-color)); }
  .speech-bubble {
    background:rgba(255,255,255,.04); border:1px solid var(--border);
    border-radius:8px; padding:0.55rem 0.7rem;
    font-size:0.76rem; color:var(--text2); font-style:italic;
    min-height:36px;
  }
  .mood-row { display:flex; gap:0.25rem; margin-bottom:0.4rem; align-items:center; }
  .mood-star { font-size:0.68rem; color:var(--text3); }
  .mood-star.active { color:var(--neon-amber); }

  /* ‚îÄ‚îÄ REPORT ‚îÄ‚îÄ */
  .report-panel {
    background:linear-gradient(135deg,rgba(0,212,255,.05),rgba(0,255,157,.03));
    border:1px solid rgba(0,212,255,.2);
    border-radius:14px; padding:1.2rem;
    display:none; margin-top:1rem;
    animation: slideIn 0.4s ease;
  }
  .report-panel.visible { display:block; }
  @keyframes slideIn { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:none} }
  .report-title { font-family:'Rajdhani',sans-serif; font-size:1rem; font-weight:700; color:var(--neon-blue); margin-bottom:0.75rem; }
  .report-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:0.4rem; margin-bottom:0.75rem; }
  .report-item {
    background:var(--glass2); border-radius:8px; padding:0.5rem 0.65rem;
    display:flex; justify-content:space-between; align-items:center;
  }
  .report-key { font-size:0.72rem; color:var(--text2); }
  .report-chg { font-family:'Share Tech Mono',monospace; font-size:0.82rem; font-weight:700; }
  .report-chg.pos { color:var(--neon-green); }
  .report-chg.neg { color:var(--neon-red); }
  .report-chg.neu { color:var(--text3); }

  .report-insight {
    background:rgba(255,184,0,.07); border:1px solid rgba(255,184,0,.2);
    border-radius:8px; padding:0.65rem 0.8rem;
    font-size:0.8rem; color:var(--text); line-height:1.55;
    margin-bottom:0.75rem;
  }
  .report-insight strong { color:var(--neon-amber); }

  .btn-row { display:flex; gap:0.75rem; margin-top:0.9rem; flex-wrap:wrap; }
  .btn-primary {
    background:linear-gradient(135deg,rgba(0,212,255,.15),rgba(0,255,157,.1));
    border:1px solid rgba(0,212,255,.4); color:var(--neon-blue);
    border-radius:10px; padding:0.6rem 1.4rem;
    font-family:'Rajdhani',sans-serif; font-size:1rem; font-weight:700;
    cursor:pointer; transition:all 0.2s; letter-spacing:0.05em;
  }
  .btn-primary:hover { background:linear-gradient(135deg,rgba(0,212,255,.25),rgba(0,255,157,.15)); box-shadow:0 4px 16px rgba(0,212,255,.2); }
  .btn-primary.green { border-color:rgba(0,255,157,.4); color:var(--neon-green); background:linear-gradient(135deg,rgba(0,255,157,.12),rgba(0,212,255,.08)); }
  .btn-secondary {
    background:var(--glass2); border:1px solid var(--border2);
    color:var(--text2); border-radius:10px; padding:0.6rem 1.2rem;
    font-family:'Rajdhani',sans-serif; font-size:0.9rem; font-weight:600;
    cursor:pointer; transition:all 0.2s;
  }
  .btn-secondary:hover { border-color:var(--border2); color:var(--text); }

  /* ‚îÄ‚îÄ WIN CONDITIONS ‚îÄ‚îÄ */
  .win-cond-item {
    background:var(--glass2); border:1px solid var(--border);
    border-radius:10px; padding:0.55rem 0.7rem;
    margin-bottom:0.4rem; transition:border-color 0.3s;
  }
  .win-cond-item.done   { border-color:rgba(0,255,157,.4); background:rgba(0,255,157,.06); }
  .win-cond-item.danger { border-color:rgba(255,51,102,.4); background:rgba(255,51,102,.06); }
  .win-cond-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:0.3rem; }
  .win-cond-label { font-size:0.75rem; font-weight:600; color:var(--text2); display:flex; align-items:center; gap:0.35rem; }
  .win-cond-vals  { font-family:'Share Tech Mono',monospace; font-size:0.75rem; white-space:nowrap; }
  .win-cond-track { height:6px; background:rgba(255,255,255,.06); border-radius:4px; overflow:hidden; position:relative; }
  .win-cond-fill  { height:100%; border-radius:4px; transition:width 0.8s cubic-bezier(.4,0,.2,1); }

  /* ‚îÄ‚îÄ CRISIS BANNER ‚îÄ‚îÄ */
  .crisis-banner {
    position:fixed; top:72px; left:50%;
    transform:translateX(-50%) translateY(-20px);
    background:rgba(255,20,60,.15); border:1px solid rgba(255,51,102,.5);
    color:var(--neon-red); border-radius:10px; padding:0.7rem 1.4rem;
    font-family:'Rajdhani',sans-serif; font-size:1rem; font-weight:700;
    letter-spacing:0.05em; z-index:200; opacity:0; transition:all 0.4s ease;
    white-space:nowrap; backdrop-filter:blur(10px);
  }
  .crisis-banner.show { opacity:1; transform:translateX(-50%) translateY(0); }

  /* ‚îÄ‚îÄ PHASE DOTS ‚îÄ‚îÄ */
  .phase-row { display:flex; gap:0.3rem; align-items:center; margin-bottom:0.9rem; flex-wrap:wrap; }
  .phase-dot { width:20px; height:4px; border-radius:2px; background:rgba(255,255,255,0.1); transition:background .4s; }
  .phase-dot.done   { background:var(--neon-green); }
  .phase-dot.active { background:var(--neon-blue); animation:phasePulse 1.5s infinite; }
  @keyframes phasePulse { 0%,100%{opacity:1} 50%{opacity:.5} }

  /* ‚îÄ‚îÄ TIMELINE ‚îÄ‚îÄ */
  .timeline { display:flex; flex-direction:column; gap:0.35rem; }
  .timeline-entry {
    font-size:0.75rem; color:var(--text3); padding:0.3rem 0;
    border-bottom:1px solid rgba(255,255,255,.04);
    display:flex; gap:0.5rem;
  }
  .timeline-rnd { color:var(--neon-blue); font-family:'Share Tech Mono',monospace; min-width:2.2rem; flex-shrink:0; }
  .timeline-event { color:var(--text2); flex:1; }
  .timeline-decision { color:var(--text3); font-style:italic; }

  /* ‚îÄ‚îÄ MOBILE TABS ‚îÄ‚îÄ */
  .mobile-tabs {
    display:none; justify-content:center; gap:0.4rem;
    padding:0.6rem 1rem; background:var(--bg); /* pure dark, not bg2 */
    border-bottom:1px solid var(--border); flex-wrap:wrap;
  }
  @media(max-width:1100px){
    .mobile-tabs { display:flex; }
    .game-main { grid-template-columns:1fr; }
    .col-left,.col-right { display:none; }

    /* darken all panels on mobile so nothing looks washed out */
    .panel {
      background: rgba(8,12,20,0.95);
      border-color: var(--border2);
    }
    .kpi-card {
      background: rgba(13,20,32,0.98);
    }
    .actor-card {
      background: rgba(13,20,32,0.98);
    }
    .event-card {
      background: rgba(13,20,32,0.98);
    }
    .decision-card {
      background: rgba(13,20,32,0.95);
    }
    .report-panel {
      background: rgba(8,12,20,0.98);
    }
    /* phase dots ‚Äì bigger hit area, more visible */
    .phase-row {
      gap: 0.25rem;
    }
    .phase-dot {
      width: 16px;
      height: 5px;
      background: rgba(255,255,255,0.12); /* darker default */
    }
    .phase-dot.done   { background: var(--neon-green); opacity: 0.85; }
    .phase-dot.active { background: var(--neon-blue); }
  }

  .tab-btn {
    background: rgba(8,12,20,0.9);
    border:1px solid var(--border); border-radius:8px;
    padding:0.35rem 0.75rem; color:var(--text3); font-size:0.78rem;
    cursor:pointer; transition:all .2s; font-family:'Exo 2',sans-serif;
  }
  .tab-btn.active {
    background: rgba(0,212,255,0.1);
    border-color:var(--neon-blue); color:var(--neon-blue);
  }

  /* ‚îÄ‚îÄ TYPING ‚îÄ‚îÄ */
  .typing::after { content:'|'; animation:blink .7s infinite; }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }

  /* ‚îÄ‚îÄ END SCREEN ‚îÄ‚îÄ */
  #endScreen {
    flex-direction:column; align-items:center; justify-content:flex-start;
    background:rgba(8,12,20,.97); backdrop-filter:blur(20px);
    padding:3rem 2rem; text-align:center; overflow-y:auto;
  }
  .end-icon { font-size:4rem; margin-bottom:0.75rem; }
  .end-title { font-family:'Rajdhani',sans-serif; font-size:2.8rem; font-weight:800; margin-bottom:0.4rem; }
  .end-title.win  { background:linear-gradient(135deg,var(--neon-green),var(--neon-blue)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
  .end-title.lose { color:var(--neon-red); }
  .end-reason     { color:var(--text2); font-size:1rem; margin-bottom:1.5rem; max-width:520px; line-height:1.7; }
  .end-stats {
    background:var(--glass); border:1px solid var(--border); border-radius:14px;
    padding:1.3rem; max-width:520px; width:100%; margin-bottom:1.5rem; text-align:left;
  }
  .end-stat-row { display:flex; justify-content:space-between; align-items:center; padding:0.38rem 0; border-bottom:1px solid var(--border); }
  .end-stat-row:last-child { border-bottom:none; }
  .end-stat-key { color:var(--text2); font-size:0.88rem; }
  .end-stat-val { font-family:'Share Tech Mono',monospace; font-weight:700; }

  /* Feedback section in end screen */
  .end-feedback {
    background:linear-gradient(135deg,rgba(255,184,0,.07),rgba(0,212,255,.05));
    border:1px solid rgba(255,184,0,.2);
    border-radius:14px; padding:1.3rem;
    max-width:520px; width:100%; margin-bottom:1.5rem; text-align:left;
  }
  .end-feedback-title { font-family:'Rajdhani',sans-serif; font-size:1rem; font-weight:700; color:var(--neon-amber); margin-bottom:0.75rem; }
  .feedback-item { font-size:0.82rem; color:var(--text2); line-height:1.6; margin-bottom:0.5rem; padding-left:1rem; position:relative; }
  .feedback-item::before { content:'‚Üí'; position:absolute; left:0; color:var(--neon-amber); }

  /* ‚îÄ‚îÄ HELP MODAL ‚îÄ‚îÄ */
  .modal-overlay {
    display:none; position:fixed; inset:0; z-index:500;
    background:rgba(0,0,0,.7); backdrop-filter:blur(6px);
    align-items:center; justify-content:center; padding:1rem;
  }
  .modal-overlay.open { display:flex; }
  .modal {
    background:var(--bg2); border:1px solid var(--border2);
    border-radius:16px; padding:1.8rem; max-width:560px; width:100%;
    max-height:80vh; overflow-y:auto;
    animation:modalIn .3s ease;
  }
  @keyframes modalIn { from{opacity:0;transform:scale(.95)} to{opacity:1;transform:none} }
  .modal-title { font-family:'Rajdhani',sans-serif; font-size:1.4rem; font-weight:700; color:var(--neon-blue); margin-bottom:1rem; }
  .modal-close { float:right; background:none; border:none; color:var(--text2); font-size:1.3rem; cursor:pointer; line-height:1; }
  .modal-close:hover { color:var(--text); }
  .modal-section { margin-bottom:1rem; }
  .modal-section h4 { font-family:'Rajdhani',sans-serif; font-weight:600; color:var(--neon-amber); margin-bottom:0.4rem; font-size:0.95rem; }
  .modal-section p  { font-size:0.82rem; color:var(--text2); line-height:1.6; }

  /* ‚îÄ‚îÄ BONUS EVENT NOTICE ‚îÄ‚îÄ */
  .bonus-notice {
    display:none; margin-bottom:0.75rem; padding:0.55rem 0.75rem;
    background:rgba(255,184,0,.1); border:1px solid rgba(255,184,0,.3);
    border-radius:8px; font-size:0.82rem; color:var(--neon-amber);
  }

  /* ‚îÄ‚îÄ AI ACTION LOG ‚îÄ‚îÄ */
  .ai-action-entry {
    font-size:0.8rem; color:var(--text2); line-height:1.7;
    opacity:0; transition:opacity .4s;
    padding:0.3rem 0; border-bottom:1px solid var(--border);
  }
  .ai-action-entry:last-child { border-bottom:none; }
  .ai-action-entry strong { color:var(--text); }

  ::-webkit-scrollbar { width:5px; }
  ::-webkit-scrollbar-track { background:var(--bg2); }
  ::-webkit-scrollbar-thumb { background:var(--border2); border-radius:3px; }

  /* ‚îÄ‚îÄ DESKTOP SCALING (‚â•1100px) ‚îÄ‚îÄ */
  @media(min-width:1100px) {
    /* Tutorial */
    .tut-container        { max-width: 960px; gap: 2rem; }
    .tut-logo h1          { font-size: 3.2rem; }
    .tut-logo p           { font-size: 0.9rem; }
    .tut-step             { padding: 1.4rem 1.2rem; }
    .tut-step-icon        { font-size: 2.2rem; }
    .tut-step-title       { font-size: 1.15rem; }
    .tut-step-text        { font-size: 0.88rem; }
    .tut-step-num         { font-size: 0.72rem; }
    .glos-pill-term       { font-size: 0.88rem; }
    .glos-section-label   { font-size: 0.78rem; }
    .glossary-pills       { gap: 0.6rem; }
    .glos-pill            { padding: 0.5rem 0.9rem; }

    /* Role select */
    .intro-logo           { font-size: 2.4rem; }
    .intro-sub            { font-size: 0.85rem; margin-bottom: 2.2rem; }
    .role-select-grid     { gap: 1.4rem; max-width: 1080px; }
    .role-card            { padding: 1.8rem; gap: 0.7rem; }
    .role-emoji           { font-size: 2.4rem; }
    .role-name            { font-size: 1.4rem; }
    .role-alias           { font-size: 0.8rem; }
    .role-desc            { font-size: 0.92rem; line-height: 1.6; }
    .role-goal-item       { font-size: 0.85rem; gap: 0.5rem; }
    .role-goals           { gap: 0.35rem; padding-top: 0.7rem; margin-top: 0.4rem; }
    .difficulty-badge     { font-size: 0.7rem; padding: 0.2rem 0.5rem; }

    /* Header */
    .game-header          { padding: 0.9rem 2rem; gap: 1rem; }
    .header-title         { font-size: 1.6rem; }
    .round-badge          { font-size: 1rem; padding: 0.4rem 1rem; }
    .stability-badge      { font-size: 1rem; padding: 0.4rem 1rem; gap: 0.5rem; }
    .stab-dot             { width: 10px; height: 10px; }
    .role-indicator       { font-size: 0.95rem; padding: 0.4rem 1rem; }
    .help-btn             { font-size: 0.95rem; padding: 0.4rem 0.8rem; }

    /* Main layout */
    .game-main            { grid-template-columns: 310px 1fr 310px; gap: 1.2rem; padding: 1.2rem 2rem; }
    .panel                { padding: 1.3rem; }
    .panel-title          { font-size: 0.82rem; margin-bottom: 1.1rem; }

    /* KPIs */
    .kpi-grid             { gap: 0.85rem; }
    .kpi-card             { padding: 0.9rem; }
    .kpi-name             { font-size: 0.92rem; }
    .kpi-value            { font-size: 1.25rem; }
    .kpi-delta            { font-size: 0.82rem; }
    .kpi-bar-bg           { height: 7px; }

    /* Event */
    .event-card           { padding: 1.8rem; margin-bottom: 1.3rem; }
    .event-tag            { font-size: 0.8rem; }
    .event-title          { font-size: 1.9rem; }
    .event-desc           { font-size: 1rem; line-height: 1.7; }
    .impact-chip          { font-size: 0.78rem; padding: 0.2rem 0.6rem; }

    /* Decisions */
    .decisions-label      { font-size: 0.85rem; margin-bottom: 0.7rem; }
    .decisions-grid       { gap: 0.9rem; }
    .decision-card        { padding: 1.3rem; border-radius: 14px; }
    .decision-emoji       { font-size: 1.9rem; margin-bottom: 0.6rem; }
    .decision-title       { font-size: 1.15rem; margin-bottom: 0.5rem; }
    .decision-desc        { font-size: 0.85rem; }
    .chip                 { font-size: 0.75rem; padding: 0.18rem 0.5rem; }
    .tradeoff-badge       { font-size: 0.7rem; padding: 0.18rem 0.5rem; }

    /* Actors */
    .actor-card           { padding: 1.1rem; margin-bottom: 0.85rem; }
    .actor-emoji          { font-size: 1.8rem; }
    .actor-name           { font-size: 1.1rem; }
    .actor-role           { font-size: 0.8rem; }
    .happy-label          { font-size: 0.82rem; }
    .happy-val            { font-size: 1rem; }
    .speech-bubble        { font-size: 0.88rem; padding: 0.7rem 0.9rem; }
    .mood-star            { font-size: 0.8rem; }
    .happy-bar-bg         { height: 6px; }

    /* Win conditions */
    .win-cond-label       { font-size: 0.88rem; }
    .win-cond-vals        { font-size: 0.88rem; }
    .win-cond-track       { height: 8px; }
    .win-cond-item        { padding: 0.7rem 0.9rem; margin-bottom: 0.55rem; }

    /* Phase dots */
    .phase-dot            { width: 26px; height: 5px; }

    /* Timeline */
    .timeline-entry       { font-size: 0.85rem; }

    /* Report */
    .report-panel         { padding: 1.5rem; }
    .report-title         { font-size: 1.2rem; }
    .report-key           { font-size: 0.85rem; }
    .report-chg           { font-size: 0.95rem; }
    .report-item          { padding: 0.6rem 0.8rem; }
    .report-insight       { font-size: 0.92rem; padding: 0.8rem 1rem; }

    /* Buttons */
    .btn-primary          { font-size: 1.1rem; padding: 0.75rem 1.8rem; border-radius: 12px; }
    .btn-secondary        { font-size: 1rem; padding: 0.7rem 1.4rem; }
  }

  /* ‚îÄ‚îÄ MOBILE GLOBAL FIXES ‚îÄ‚îÄ */
  @media(max-width:768px) {
    /* Tutorial screen */
    .tut-step {
      background: rgba(8,12,20,0.95);
      border-color: rgba(255,255,255,0.1);
    }
    .glos-pill {
      background: rgba(8,12,20,0.95);
      border-color: rgba(255,255,255,0.1);
    }
    /* Role cards */
    .role-card {
      background: rgba(8,12,20,0.95);
      border-color: rgba(255,255,255,0.1);
    }
    /* Win condition items */
    .win-cond-item {
      background: rgba(8,12,20,0.95);
    }
    .win-cond-track {
      background: rgba(255,255,255,0.08);
    }
    /* Report items */
    .report-item {
      background: rgba(8,12,20,0.95);
    }
    /* KPI bars background */
    .kpi-bar-bg, .happy-bar-bg {
      background: rgba(255,255,255,0.08);
    }
    /* Speech bubbles */
    .speech-bubble {
      background: rgba(8,12,20,0.9);
      border-color: rgba(255,255,255,0.08);
    }
    /* Stability badge */
    .stability-badge {
      background: rgba(8,12,20,0.95);
    }
    /* Round badge */
    .round-badge {
      background: rgba(8,12,20,0.95);
    }
    /* Header */
    .game-header {
      background: rgba(4,8,14,0.98);
    }
    /* End screen */
    .end-stats, .end-feedback {
      background: rgba(8,12,20,0.98);
    }
  }
</style>
</head>
<body>

<!-- ‚îÄ‚îÄ TUTORIAL SCREEN ‚îÄ‚îÄ -->
<div id="tutorialScreen" class="screen active">
  <div class="tut-container">

    <div class="tut-logo">
      <h1>üá©üá™ Deutschland im Gleichgewicht</h1>
      <p>Serious Game ¬∑ Volkswirtschaft ¬∑ Bildung</p>
    </div>

    <div class="tut-flow">
      <div class="tut-step">
        <div class="tut-step-icon">üé≠</div>
        <div class="tut-step-num">SCHRITT 01</div>
        <div class="tut-step-title">Rolle w√§hlen</div>
        <div class="tut-step-text">Kanzler, Konzern oder Familie ‚Äì jede Perspektive hat andere Ziele.</div>
      </div>
      <div class="tut-step">
        <div class="tut-step-icon">üì∞</div>
        <div class="tut-step-num">SCHRITT 02</div>
        <div class="tut-step-title">Ereignis lesen</div>
        <div class="tut-step-text">Jede Runde trifft Deutschland ein Wirtschaftsereignis ‚Äì unabh√§ngig von dir.</div>
      </div>
      <div class="tut-step">
        <div class="tut-step-icon">üéØ</div>
        <div class="tut-step-num">SCHRITT 03</div>
        <div class="tut-step-title">Entscheiden</div>
        <div class="tut-step-text">4 Optionen, keine perfekt. <span style="color:var(--neon-amber)">ABW√ÑGUNG</span> = echte Trade-offs.</div>
      </div>
      <div class="tut-step">
        <div class="tut-step-icon">üìä</div>
        <div class="tut-step-num">SCHRITT 04</div>
        <div class="tut-step-title">Folgen beobachten</div>
        <div class="tut-step-text">Report zeigt was sich ver√§ndert hat ‚Äì und warum.</div>
      </div>
    </div>

    <div>
      <div class="glos-section-label">üìö Begriffe ‚Äì hover f√ºr Erkl√§rung</div>
      <div class="glossary-pills">
        <div class="glos-pill"><span class="glos-pill-term">BIP</span><div class="glos-pill-def">Bruttoinlandsprodukt: Gesamtwert aller produzierten G√ºter. Steigt BIP = Wirtschaft w√§chst.</div></div>
        <div class="glos-pill"><span class="glos-pill-term">Inflation</span><div class="glos-pill-def">Preisanstieg. Zu hoch = Kaufkraft sinkt, Geld wird weniger wert. Ziel: ~2%.</div></div>
        <div class="glos-pill"><span class="glos-pill-term">Besch√§ftigung</span><div class="glos-pill-def">Anteil der arbeitenden Bev√∂lkerung. Niedrig = Arbeitslosigkeit, weniger Steuereinnahmen.</div></div>
        <div class="glos-pill"><span class="glos-pill-term">Budgetstabilit√§t</span><div class="glos-pill-def">Staatsfinanzen. Sinkt zu stark, kann der Staat nicht mehr handeln.</div></div>
        <div class="glos-pill"><span class="glos-pill-term">Kaufkraft</span><div class="glos-pill-def">Was du dir nach Inflation wirklich leisten kannst. BIP minus halbe Inflation.</div></div>
        <div class="glos-pill"><span class="glos-pill-term">Trade-off</span><div class="glos-pill-def">Eine Entscheidung verbessert etwas, verschlechtert gleichzeitig etwas anderes. Kein Weg ist gratis.</div></div>
        <div class="glos-pill"><span class="glos-pill-term">Rezession</span><div class="glos-pill-def">Wirtschaft schrumpft mehrere Quartale. Jobs fallen weg, Unternehmen machen Verluste.</div></div>
        <div class="glos-pill"><span class="glos-pill-term">Stabilit√§tsindex</span><div class="glos-pill-def">Kombiniert Besch√§ftigung + Budget + (100‚àíInflation) + √ò Zufriedenheit. F√§llt er unter 20: Niederlage.</div></div>
      </div>
    </div>

    <div class="tut-btn-row">
      <button class="btn-primary green" onclick="showIntro()">Rolle w√§hlen ‚Üí</button>
    </div>

  </div>
</div>

<!-- ‚îÄ‚îÄ ROLE SELECT SCREEN ‚îÄ‚îÄ -->
<div id="introScreen" class="screen">
  <div style="position:relative;z-index:1;width:100%;max-width:860px;padding:0 1rem;">
    <div class="intro-logo">W√§hle deine Rolle</div>
    <div class="intro-sub">12 Runden ¬∑ 3 Perspektiven ¬∑ echte Trade-offs</div>

    <div class="role-select-grid">

      <div class="role-card" data-role="gov" onclick="startGame('gov')">
        <span class="difficulty-badge diff-medium">MITTEL</span>
        <div class="role-card-top">
          <span class="role-emoji">üèõÔ∏è</span>
          <div>
            <div class="role-name">Friedrich Merz</div>
            <div class="role-alias">Bundeskanzler</div>
          </div>
        </div>
        <div class="role-desc">Steuerst die Wirtschaftspolitik. Zwischen Haushalt, Soziales und Wachstum.</div>
        <div class="role-goals">
          <div class="role-goal-item"><span>‚öôÔ∏è</span> Besch√§ftigung ‚â• 72</div>
          <div class="role-goal-item"><span>üí∞</span> Budget ‚â• 60</div>
          <div class="role-goal-item"><span>ü§ù</span> Min. 2 Akteure zufrieden ‚â• 60</div>
        </div>
      </div>

      <div class="role-card" data-role="biz" onclick="startGame('biz')">
        <span class="difficulty-badge diff-hard">SCHWER</span>
        <div class="role-card-top">
          <span class="role-emoji">üè≠</span>
          <div>
            <div class="role-name">AutoNova AG</div>
            <div class="role-alias">Automobilkonzern</div>
          </div>
        </div>
        <div class="role-desc">Profit vs. Verantwortung. Verlagerst du ins Ausland ‚Äì oder investierst du?</div>
        <div class="role-goals">
          <div class="role-goal-item"><span>üíπ</span> Gewinn ‚â• 78</div>
          <div class="role-goal-item"><span>üë∑</span> Besch√§ftigung ‚â• 50</div>
          <div class="role-goal-item"><span>üèõÔ∏è</span> Staatsrahmen ‚â• 45</div>
        </div>
      </div>

      <div class="role-card" data-role="hh" onclick="startGame('hh')">
        <span class="difficulty-badge diff-easy">EINSTEIGER</span>
        <div class="role-card-top">
          <span class="role-emoji">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
          <div>
            <div class="role-name">Familie Schneider</div>
            <div class="role-alias">Mittelstandshaushalt</div>
          </div>
        </div>
        <div class="role-desc">Sp√ºrst jeden Schock zuerst. Konsum, Sparen, Weiterbildung oder Protest?</div>
        <div class="role-goals">
          <div class="role-goal-item"><span>üòä</span> Familienwohl ‚â• 72</div>
          <div class="role-goal-item"><span>üí≥</span> Kaufkraft ‚â• 52</div>
          <div class="role-goal-item"><span>üîí</span> Jobsicherheit ‚â• 58</div>
        </div>
      </div>

    </div>
    <div style="text-align:center;margin-top:1.2rem;position:relative;z-index:1;">
      <button class="btn-secondary" onclick="showTutorial()" style="font-size:0.78rem;">‚Üê Zur√ºck</button>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ GAME SCREEN ‚îÄ‚îÄ -->
<div id="gameScreen" class="screen">
  <div id="crisisBanner" class="crisis-banner">‚ö†Ô∏è Krisenwarnung</div>

  <header class="game-header">
    <div class="header-title">üá©üá™ Deutschland im Gleichgewicht</div>
    <div class="header-sep"></div>
    <div id="roleIndicator" class="role-indicator gov">Kanzler</div>
    <div id="roundBadge" class="round-badge">Runde 1 / 12</div>
    <div class="stability-badge">
      <div id="stabDot" class="stab-dot"></div>
      <span id="stabLabel">Stabil</span>
      <span id="stabVal" style="font-weight:700;color:var(--neon-green);">85</span>
      <div class="stab-tooltip">
        <strong style="color:var(--neon-amber)">Stabilit√§tsindex</strong><br>
        Kombiniert: Besch√§ftigung, Budget,<br>
        (100‚àíInflation) und ‚àÖ Zufriedenheit.<br>
        ‚â•65 = stabil ¬∑ 48-64 = angespannt ¬∑ &lt;48 = kritisch
      </div>
    </div>
    <button class="help-btn" onclick="openHelp()">‚ùì Hilfe</button>
  </header>

  <div class="mobile-tabs">
    <button class="tab-btn active" onclick="switchTab('center')">üìã Ereignis</button>
    <button class="tab-btn" onclick="switchTab('left')">üìä Status</button>
    <button class="tab-btn" onclick="switchTab('right')">üë• Akteure</button>
  </div>

  <div class="game-main">

    <!-- LEFT: STATUS -->
    <div class="col-left panel">
      <div class="panel-title" id="leftPanelTitle">üìä Status</div>
      <div class="phase-row" id="phaseRow"></div>
      <div id="kpiGrid" class="kpi-grid"></div>

      <!-- hidden for legacy compat -->
      <div style="display:none">
        <span id="val-employment">0</span><span id="delta-employment"></span>
        <span id="val-gdp">0</span><span id="delta-gdp"></span>
        <span id="val-inflation">0</span><span id="delta-inflation"></span>
        <span id="val-budget">0</span><span id="delta-budget"></span>
        <span id="val-govHappy">0</span><span id="val-bizHappy">0</span><span id="val-hhHappy">0</span>
      </div>

      <div style="margin-top:1rem;border-top:1px solid var(--border);padding-top:1rem;">
        <div class="panel-title">üìú Chronik</div>
        <div class="timeline" id="timeline">
          <div style="color:var(--text3);font-size:0.76rem;">Noch keine Ereignisse.</div>
        </div>
      </div>
    </div>

    <!-- CENTER: EVENT + DECISIONS -->
    <div class="col-center" id="centerCol">

      <div class="panel-title" style="margin-bottom:0.5rem;">üé¥ AKTUELLES EREIGNIS</div>
      <div class="event-card" id="eventCard">
        <div class="event-tag" id="eventTag">Runde 1 ¬∑ Ereignis</div>
        <div class="event-title" id="eventTitle">‚è≥ Spiel l√§dt...</div>
        <div class="event-desc" id="eventDesc">Die Simulation startet gleich.</div>
        <div class="event-impact" id="eventImpact"></div>
      </div>

      <div class="decisions-label">üéØ DEINE ENTSCHEIDUNG <span style="color:var(--text3);font-weight:400;font-size:0.65rem;letter-spacing:0;text-transform:none;font-style:italic;">W√§hle weise ‚Äì keine Option ist ohne Preis</span></div>
      <div class="decisions-grid" id="decisionsGrid"></div>

      <div id="reportPanel" class="report-panel">
        <div class="report-title">üìã Rundenreport</div>
        <div class="bonus-notice" id="bonusEventNotice"></div>
        <div class="report-grid" id="reportGrid"></div>
        <div class="report-insight" id="reportInsight"></div>
        <div style="margin-top:0.5rem;border-top:1px solid var(--border);padding-top:0.6rem;">
          <div class="panel-title" style="margin-bottom:0.5rem;">ü§ñ KI-Akteure reagieren</div>
          <div id="aiActionsLog"></div>
        </div>
        <div class="btn-row">
          <button id="nextRoundBtn" class="btn-primary green" onclick="nextRound()">N√§chste Runde ‚Üí</button>
        </div>
      </div>
    </div>

    <!-- RIGHT: ACTORS + WIN CONDITIONS -->
    <div class="col-right panel">
      <div class="panel-title">üë• Akteure</div>

      <div class="actor-card gov" id="actorGov">
        <div class="actor-header">
          <div class="actor-emoji">üèõÔ∏è</div>
          <div class="actor-info">
            <div class="actor-name">Friedrich Merz</div>
            <div class="actor-role">Bundesregierung</div>
          </div>
          <span class="player-tag" id="govPlayerTag" style="display:none">DU</span>
        </div>
        <div class="mood-row" id="govMood"></div>
        <div class="happy-row">
          <span class="happy-label">Zufriedenheit</span>
          <span class="happy-val c-gov" id="val-govHappy2">65</span>
        </div>
        <div class="happy-bar-bg"><div class="happy-bar gov" id="bar-govHappy" style="width:65%"></div></div>
        <div class="speech-bubble" id="speech-gov">Wir arbeiten an einer stabilen Zukunft f√ºr Deutschland.</div>
      </div>

      <div class="actor-card biz" id="actorBiz">
        <div class="actor-header">
          <div class="actor-emoji">üè≠</div>
          <div class="actor-info">
            <div class="actor-name">AutoNova AG</div>
            <div class="actor-role">Automobilkonzern</div>
          </div>
          <span class="player-tag" id="bizPlayerTag" style="display:none">DU</span>
        </div>
        <div class="mood-row" id="bizMood"></div>
        <div class="happy-row">
          <span class="happy-label">Zufriedenheit</span>
          <span class="happy-val c-biz" id="val-bizHappy2">60</span>
        </div>
        <div class="happy-bar-bg"><div class="happy-bar biz" id="bar-bizHappy" style="width:60%"></div></div>
        <div class="speech-bubble" id="speech-biz">Stabile Rahmenbedingungen sind f√ºr uns entscheidend.</div>
      </div>

      <div class="actor-card hh" id="actorHh">
        <div class="actor-header">
          <div class="actor-emoji">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
          <div class="actor-info">
            <div class="actor-name">Familie Schneider</div>
            <div class="actor-role">Mittelstandshaushalt</div>
          </div>
          <span class="player-tag" id="hhPlayerTag" style="display:none">DU</span>
        </div>
        <div class="mood-row" id="hhMood"></div>
        <div class="happy-row">
          <span class="happy-label">Zufriedenheit</span>
          <span class="happy-val c-hh" id="val-hhHappy2">62</span>
        </div>
        <div class="happy-bar-bg"><div class="happy-bar hh" id="bar-hhHappy" style="width:62%"></div></div>
        <div class="speech-bubble" id="speech-hh">Wir hoffen auf bessere Zeiten f√ºr unsere Familie.</div>
      </div>

      <div style="margin-top:0.75rem;">
        <div class="panel-title">üèÜ Dein Ziel</div>
        <div id="winCondPanel"></div>
      </div>
    </div>

  </div>
</div>

<!-- ‚îÄ‚îÄ END SCREEN ‚îÄ‚îÄ -->
<div id="endScreen" class="screen">
  <div class="end-icon" id="endIcon">üèÜ</div>
  <div class="end-title win" id="endTitle">Sieg!</div>
  <div class="end-reason" id="endReason">Du hast Deutschland durch die Krise gef√ºhrt.</div>
  <div class="end-stats" id="endStats"></div>
  <div class="end-feedback" id="endFeedback">
    <div class="end-feedback-title">üí° Was hast du gelernt?</div>
    <div id="feedbackItems"></div>
  </div>
  <div style="display:flex;gap:1rem;flex-wrap:wrap;justify-content:center;">
    <button class="btn-primary green" onclick="resetGame()">üîÑ Neue Runde</button>
    <button class="btn-secondary" onclick="showTutorial()">üìö Begriffe nochmal lesen</button>
  </div>
</div>

<!-- ‚îÄ‚îÄ HELP MODAL ‚îÄ‚îÄ -->
<div id="helpModal" class="modal-overlay">
  <div class="modal">
    <button class="modal-close" onclick="closeHelp()">‚úï</button>
    <div class="modal-title">‚ùì Spielhilfe</div>
    <div class="modal-section">
      <h4>Wie gewinne ich?</h4>
      <p>Du musst alle drei deiner Siegbedingungen (rechte Spalte) bis zum Ende von Runde 12 erf√ºllen. Die Bedingungen h√§ngen von deiner Rolle ab. Behalte den Stabilit√§tsindex im Auge ‚Äì f√§llt er unter 30, verlierst du sofort.</p>
    </div>
    <div class="modal-section">
      <h4>Was sind Trade-offs?</h4>
      <p>Karten mit dem <span style="color:var(--neon-amber);font-family:monospace;font-size:0.8rem;">ABW√ÑGUNG</span>-Badge haben starke Widerspr√ºche: z.B. sichert eine Ma√ünahme Jobs, belastet aber gleichzeitig das Budget. Diese Entscheidungen sind realistisch ‚Äì es gibt keine kostenlose Option.</p>
    </div>
    <div class="modal-section">
      <h4>Was machen die KI-Akteure?</h4>
      <p>Die anderen zwei Rollen (die du nicht spielst) agieren automatisch. Ihre Entscheidungen h√§ngen von ihrer aktuellen Zufriedenheit und dem Ereignis ab. Ein unzufriedener Konzern droht z.B. mit Verlagerung ins Ausland.</p>
    </div>
    <div class="modal-section">
      <h4>Was ist der Stabilit√§tsindex?</h4>
      <p>Ein Gesamtwert aus: Besch√§ftigung + Budgetstabilit√§t + (100 ‚àí Inflation) + √ò Zufriedenheit aller drei Akteure. Er gibt dir auf einen Blick, ob Deutschland stabil ist. Unter 30 = Systemkollaps ‚Üí Niederlage.</p>
    </div>
    <div class="modal-section">
      <h4>Warum passieren manchmal Bonus-Ereignisse?</h4>
      <p>In 25% der Runden trifft ein zweites, unerwartetes Ereignis mit halber St√§rke ein. Das spiegelt reale Wirtschaftsvolatilit√§t wider ‚Äì man kann nicht alles kontrollieren.</p>
    </div>
    <div style="text-align:center;margin-top:1rem;">
      <button class="btn-primary" onclick="closeHelp()">Verstanden ‚Üí</button>
    </div>
  </div>
</div>

<script>
'use strict';

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// EVENTS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const EVENTS = [
  { id:'energy',            title:'‚ö° Energiepreise explodieren', description:'Ein neuer Schock auf dem Energiemarkt treibt Strom und Gas auf Rekordniveau. Industrie und Haushalte leiden gleicherma√üen.', baseEffects:{ employment:-4, gdp:-6, inflation:+10, budget:-5 }, impactLabels:['-BIP','+Inflation stark','-Budget'] },
  { id:'fachkraeftemangel', title:'üßë‚Äçüíº Fachkr√§ftemangel',           description:'Qualifizierte Arbeitskr√§fte fehlen in Schl√ºsselbranchen. Auftr√§ge bleiben liegen, L√∂hne steigen ‚Äì aber das reicht nicht.',        baseEffects:{ employment:-3, gdp:-4, inflation:+3, budget:-2 },  impactLabels:['-Besch√§ftigung','+Lohnkosten','offene Stellen'] },
  { id:'exportboom',        title:'üöÄ Exportboom',                  description:'Die globale Nachfrage nach deutschen Produkten steigt stark. Auftragsb√ºcher sind voll ‚Äì eine seltene Chance.',                       baseEffects:{ employment:+6, gdp:+8, inflation:+4, budget:+5 },  impactLabels:['+BIP stark','+Jobs','+Steuereinnahmen'] },
  { id:'rezession',         title:'üìâ Weltweite Rezession',         description:'Eine globale Wirtschaftskrise erreicht Deutschland. Exporte brechen ein, Konsum sinkt ‚Äì die Abw√§rtsspirale beginnt.',             baseEffects:{ employment:-8, gdp:-10, inflation:-3, budget:-8 }, impactLabels:['-BIP stark','-Jobs stark','-Einnahmen'] },
  { id:'automation',        title:'ü§ñ Automatisierungsschub',       description:'KI und Robotik ersetzen Routinet√§tigkeiten in gro√üem Ma√üstab. Produktivit√§t steigt ‚Äì aber Hunderttausende Jobs fallen weg.',      baseEffects:{ employment:-6, gdp:+5, inflation:-2, budget:+2 },  impactLabels:['-Jobs','+Effizienz','Umbruch'] },
  { id:'grossinvestor',     title:'üèóÔ∏è Gro√üinvestor kommt',          description:'Ein internationaler Konzern k√ºndigt eine Milliarden-Investition in Deutschland an. Standort Deutschland gewinnt.',                 baseEffects:{ employment:+7, gdp:+6, inflation:+2, budget:+4 },  impactLabels:['+Jobs','+BIP','+Vertrauen'] },
  { id:'inflation_spike',   title:'üí∏ Inflation steigt stark',      description:'Verbraucherpreise explodieren. Mieten, Lebensmittel, Energie ‚Äì alles wird teurer. Die Kaufkraft der Haushalte bricht ein.',        baseEffects:{ employment:-2, gdp:-3, inflation:+12, budget:-4 }, impactLabels:['+Inflation stark','-Kaufkraft','-Nachfrage'] },
  { id:'lieferkette',       title:'‚õìÔ∏è Lieferkettenprobleme',        description:'Kritische Rohstoffe und Bauteile fehlen. Produktionsstopps bei Autoproduzenten, Elektronik und Maschinenbau drohen.',             baseEffects:{ employment:-5, gdp:-7, inflation:+6, budget:-3 },  impactLabels:['-BIP','+Preise','Produktionsstopps'] },
  { id:'immobilien',        title:'üèòÔ∏è Immobilienpreise steigen',    description:'Wohnraum wird knapper und teurer. Mieter leiden, Eigent√ºmer profitieren, Baukr√§ne fehlen. Soziale Schieflage w√§chst.',            baseEffects:{ employment:0, gdp:+2, inflation:+5, budget:+1 },   impactLabels:['+Inflation','-Kaufkraft Mieter','soziale Spannung'] },
  { id:'techboom',          title:'üí° Technologie-Boom',            description:'Startups und Tech-Konzerne schaffen neue Arbeitspl√§tze und treiben Innovation voran. Digitalisierung beschleunigt.',                baseEffects:{ employment:+5, gdp:+7, inflation:+2, budget:+3 },  impactLabels:['+Jobs','+BIP','+Innovation'] },
  { id:'handel',            title:'‚öñÔ∏è Handelskonflikte',            description:'Neue Z√∂lle und Strafma√ünahmen aus USA und China treffen den deutschen Exportsektor empfindlich. Gegenz√∂lle drohen.',              baseEffects:{ employment:-4, gdp:-6, inflation:+3, budget:-3 },  impactLabels:['-Export','-Jobs','+Unsicherheit'] },
  { id:'migration',         title:'üåç Qualifizierte Zuwanderung',   description:'Zuwanderung qualifizierter Arbeitskr√§fte aus dem Ausland w√§chst stark ‚Äì eine Chance f√ºr Mangelbranchen.',                        baseEffects:{ employment:+4, gdp:+3, inflation:+1, budget:-3 },  impactLabels:['+Fachkr√§fte','+BIP','-Budget Integration'] },
  { id:'steuer_reform',     title:'üìë Steuerreform-Debatte',        description:'Eine geplante Unternehmenssteuerreform sorgt f√ºr Unsicherheit bei Investoren. Investitionen werden zur√ºckgehalten.',               baseEffects:{ employment:-2, gdp:-2, inflation:0, budget:+2 },   impactLabels:['Investitionsr√ºckgang','Budget+','Unsicherheit'] },
  { id:'klimapolitik',      title:'üå± Klimapolitik-Vorsto√ü',       description:'Neue CO‚ÇÇ-Regulierungen belasten energieintensive Industrien, f√∂rdern aber gr√ºne Technologien. Strukturwandel beginnt.',           baseEffects:{ employment:-1, gdp:-2, inflation:+3, budget:-4 },  impactLabels:['-alte Industrie','+gr√ºne Jobs','Transformation'] }
];

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// DECISION TEMPLATES
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DECISION_TEMPLATES = {
  gov: [
    {
      id:'infra', emoji:'üèóÔ∏è', title:'Infrastruktur investieren',
      description:'Staatliche Investitionen in Stra√üen, Bahn, Breitband. Schafft Jobs, kostet Budget.',
      effects:{ employment:+8, gdp:+5, inflation:+3, budget:-8, govHappy:+5, bizHappy:+4, hhHappy:+4 },
      chips:[{label:'+Jobs',type:'pro'},{label:'+BIP',type:'pro'},{label:'-Budget stark',type:'con'}],
      tradeoff:true,
      eventMods:{
        energy:{ title:'Energieinfrastruktur modernisieren', effectMod:{ inflation:-3, employment:+2, budget:-4 }, chips:[{label:'Energie sichern',type:'pro'},{label:'+Jobs',type:'pro'},{label:'-Budget',type:'con'}] },
        rezession:{ title:'Konjunkturpaket: Investitionsoffensive', effectMod:{ employment:+4, gdp:+4, budget:-5 }, chips:[{label:'Krise bek√§mpfen',type:'pro'},{label:'+Jobs stark',type:'pro'},{label:'-Budget stark',type:'con'}] },
        fachkraeftemangel:{ title:'Bildungsinfrastruktur ausbauen', effectMod:{ employment:+3, hhHappy:+3, budget:-3 }, chips:[{label:'+Ausbildung',type:'pro'},{label:'+Langfrist',type:'pro'},{label:'-Budget',type:'con'}] },
        automation:{ title:'Digitale Infrastruktur f√ºr KI-Zeitalter', effectMod:{ gdp:+4, employment:+2, budget:-4 }, chips:[{label:'Zukunftssicher',type:'pro'},{label:'+Wettbewerb',type:'pro'},{label:'-Budget',type:'con'}] }
      }
    },
    {
      id:'sozial', emoji:'ü§ù', title:'Sozialleistungen erh√∂hen',
      description:'Mehr B√ºrgergeld, Wohngeld, Familienleistungen. Kostet Budget, gibt Sicherheit.',
      effects:{ employment:+2, gdp:+2, inflation:+4, budget:-7, govHappy:+3, bizHappy:-4, hhHappy:+9 },
      chips:[{label:'+Haushalte stark',type:'pro'},{label:'-Budget stark',type:'con'},{label:'-Biz',type:'con'}],
      tradeoff:true,
      eventMods:{
        inflation_spike:{ title:'Energiepauschale gegen Kaufkraftverlust', effectMod:{ hhHappy:+5, inflation:-2, budget:-3 }, chips:[{label:'Kaufkraft sch√ºtzen',type:'pro'},{label:'+Sicherheit',type:'pro'},{label:'-Budget',type:'con'}] },
        rezession:{ title:'Kurzarbeitergeld massiv ausbauen', effectMod:{ employment:+5, hhHappy:+4, budget:-4 }, chips:[{label:'Jobs sichern',type:'pro'},{label:'+Sicherheit',type:'pro'},{label:'-Budget stark',type:'con'}] },
        immobilien:{ title:'Mietpreisdeckel und Wohngeldreform', effectMod:{ hhHappy:+4, bizHappy:-3, inflation:-2 }, chips:[{label:'Wohnen sichern',type:'pro'},{label:'-Investoren',type:'con'},{label:'+Haushalte',type:'pro'}] }
      }
    },
    {
      id:'steuern', emoji:'üìâ', title:'Unternehmenssteuern senken',
      description:'Standort attraktiver f√ºr Investoren ‚Äì aber Budget leidet. Klassischer Angebotsansatz.',
      effects:{ employment:+4, gdp:+7, inflation:+1, budget:-6, govHappy:+2, bizHappy:+10, hhHappy:-2 },
      chips:[{label:'+Biz stark',type:'pro'},{label:'+Investitionen',type:'pro'},{label:'-Budget',type:'con'}],
      tradeoff:true,
      eventMods:{
        handel:{ title:'Steuerentlastung f√ºr Exporteure', effectMod:{ bizHappy:+4, gdp:+3, budget:-3 }, chips:[{label:'Export st√§rken',type:'pro'},{label:'+Wettbewerb',type:'pro'},{label:'-Budget',type:'con'}] },
        grossinvestor:{ title:'Steuererleichterungen f√ºr Gro√üinvestor', effectMod:{ gdp:+5, employment:+3, budget:-4 }, chips:[{label:'Investor sichern',type:'pro'},{label:'+Jobs',type:'pro'},{label:'-Budget',type:'con'}] }
      }
    },
    {
      id:'buerokratie', emoji:'‚úÇÔ∏è', title:'B√ºrokratie abbauen',
      description:'Deregulierung, Digitalisierung, schlankere Verwaltung. Budget-neutral, langfristig positiv.',
      effects:{ employment:+3, gdp:+4, inflation:-1, budget:+5, govHappy:+4, bizHappy:+6, hhHappy:+2 },
      chips:[{label:'+Budget',type:'pro'},{label:'+Effizienz',type:'pro'},{label:'langsam',type:'neu'}],
      tradeoff:false,
      eventMods:{
        fachkraeftemangel:{ title:'Schnellere Zuwanderungs-Anerkennung', effectMod:{ employment:+4, bizHappy:+3, govHappy:+2 }, chips:[{label:'Fachkr√§fte schnell',type:'pro'},{label:'+Unternehmen',type:'pro'},{label:'politisch hei√ü',type:'neu'}] },
        steuer_reform:{ title:'Steuer-Digitalisierung beschleunigen', effectMod:{ budget:+4, bizHappy:+4, gdp:+2 }, chips:[{label:'Planungssicherheit',type:'pro'},{label:'+Budget',type:'pro'},{label:'+Effizienz',type:'pro'}] }
      }
    }
  ],

  biz: [
    {
      id:'neue_fabrik', emoji:'üè≠', title:'Neue Fabrik in Deutschland',
      description:'Langfristige Investition schafft Jobs, bindet Kapital. Zeigt Bekenntnis zu Deutschland.',
      effects:{ employment:+9, gdp:+6, inflation:+2, budget:+4, govHappy:+6, bizHappy:+5, hhHappy:+4 },
      chips:[{label:'+Jobs',type:'pro'},{label:'+BIP',type:'pro'},{label:'kapitalintensiv',type:'neu'}],
      tradeoff:false,
      eventMods:{
        grossinvestor:{ title:'Joint-Venture mit Gro√üinvestor',  effectMod:{ gdp:+4, employment:+4, bizHappy:+4 }, chips:[{label:'Synergie',type:'pro'},{label:'+Jobs',type:'pro'},{label:'+Wachstum',type:'pro'}] },
        rezession:{ title:'Antizyklisch investieren', effectMod:{ employment:+3, budget:+2, bizHappy:-3 }, chips:[{label:'Zukunft sichern',type:'pro'},{label:'+Jobs',type:'pro'},{label:'Risiko',type:'neu'}] }
      }
    },
    {
      id:'automatisieren', emoji:'ü§ñ', title:'Automatisieren',
      description:'Roboter und KI steigern Effizienz ‚Äì kosten aber Arbeitspl√§tze. Kurzfristig gut f√ºr Profit.',
      effects:{ employment:-7, gdp:+4, inflation:-2, budget:+1, govHappy:-5, bizHappy:+9, hhHappy:-6 },
      chips:[{label:'+Profit',type:'pro'},{label:'-Jobs stark',type:'con'},{label:'-Sozialfrieden',type:'con'}],
      tradeoff:true,
      eventMods:{
        automation:{ title:'KI-F√ºhrerschaft ausbauen', effectMod:{ gdp:+5, bizHappy:+3, employment:-3 }, chips:[{label:'Marktf√ºhrer',type:'pro'},{label:'+Profit stark',type:'pro'},{label:'-Jobs stark',type:'con'}] },
        fachkraeftemangel:{ title:'Automatisierung statt Fachkr√§fte', effectMod:{ employment:-3, bizHappy:+4, gdp:+2 }, chips:[{label:'Engpass l√∂sen',type:'pro'},{label:'+Effizienz',type:'pro'},{label:'-Jobs',type:'con'}] }
      }
    },
    {
      id:'verlagerung', emoji:'‚úàÔ∏è', title:'Produktion verlagern',
      description:'Niedrigere Kosten im Ausland. Kurz: Profit steigt. Lang: Deutschland verliert Industrie.',
      effects:{ employment:-9, gdp:-6, inflation:-2, budget:-4, govHappy:-9, bizHappy:+10, hhHappy:-8 },
      chips:[{label:'+Profit stark',type:'pro'},{label:'-Jobs stark',type:'con'},{label:'Deutschland‚Üì‚Üì',type:'con'}],
      tradeoff:true,
      eventMods:{
        handel:{ title:'Produktion in Zoll-freie L√§nder', effectMod:{ bizHappy:+4, gdp:-2, govHappy:-3 }, chips:[{label:'Z√∂lle umgehen',type:'pro'},{label:'+Profit',type:'pro'},{label:'Beziehungen‚Üì',type:'con'}] },
        energy:{ title:'Produktion in energieg√ºnstigere L√§nder', effectMod:{ bizHappy:+3, inflation:-2, employment:-2 }, chips:[{label:'Energiekosten‚Üì',type:'pro'},{label:'+Marge',type:'pro'},{label:'-Jobs',type:'con'}] }
      }
    },
    {
      id:'forschung', emoji:'üî¨', title:'Forschung & Entwicklung',
      description:'Langfristige St√§rke durch Innovation. Kurzfristig kostspielig, langfristig unverzichtbar.',
      effects:{ employment:+3, gdp:+5, inflation:+1, budget:+2, govHappy:+4, bizHappy:+5, hhHappy:+3 },
      chips:[{label:'+Innovation',type:'pro'},{label:'+BIP',type:'pro'},{label:'langsam',type:'neu'}],
      tradeoff:false,
      eventMods:{
        techboom:{ title:'Tech-Boom mit Forschungssprung nutzen', effectMod:{ gdp:+5, bizHappy:+4, employment:+3 }, chips:[{label:'Boom nutzen',type:'pro'},{label:'+Wachstum stark',type:'pro'},{label:'+Jobs',type:'pro'}] },
        klimapolitik:{ title:'Gr√ºne Technologien entwickeln', effectMod:{ govHappy:+4, hhHappy:+3, gdp:+2 }, chips:[{label:'Klimaziele',type:'pro'},{label:'+Image',type:'pro'},{label:'+Zukunft',type:'pro'}] }
      }
    }
  ],

  hh: [
    {
      id:'konsum', emoji:'üõí', title:'Mehr konsumieren',
      description:'Kaufen kurbelt die Wirtschaft an ‚Äì aber erh√∂ht Inflation und ersch√∂pft Ersparnisse.',
      effects:{ employment:+4, gdp:+5, inflation:+5, budget:+2, govHappy:+3, bizHappy:+4, hhHappy:+4 },
      chips:[{label:'+BIP',type:'pro'},{label:'+Inflation',type:'con'},{label:'+Jobs',type:'pro'}],
      tradeoff:true,
      eventMods:{
        exportboom:{ title:'Konsum im Wirtschaftsboom', effectMod:{ gdp:+3, hhHappy:+3, inflation:+2 }, chips:[{label:'Wohlstand nutzen',type:'pro'},{label:'+Jobs',type:'pro'},{label:'+Inflation',type:'con'}] },
        inflation_spike:{ title:'Trotz Inflation konsumieren', effectMod:{ inflation:+4, hhHappy:-3, gdp:+2 }, chips:[{label:'Wirtschaft st√ºtzen',type:'pro'},{label:'teuer',type:'con'},{label:'-Haushalt',type:'con'}] }
      }
    },
    {
      id:'sparen', emoji:'üè¶', title:'Sparen & Absichern',
      description:'R√ºcklagen bilden sichert die Familie ab ‚Äì d√§mpft aber die Konjunktur. Sicherheit hat einen Preis.',
      effects:{ employment:-3, gdp:-5, inflation:-3, budget:+1, govHappy:-3, bizHappy:-4, hhHappy:+6 },
      chips:[{label:'+Sicherheit',type:'pro'},{label:'-Konjunktur',type:'con'},{label:'-BIP',type:'con'}],
      tradeoff:true,
      eventMods:{
        rezession:{ title:'Krisenvorbereitung: Sparreserven', effectMod:{ hhHappy:+4, gdp:-3, employment:-2 }, chips:[{label:'Krise √ºberstehen',type:'pro'},{label:'-BIP',type:'con'},{label:'n√∂tig',type:'neu'}] },
        inflation_spike:{ title:'Festzinsanlage gegen Inflation', effectMod:{ hhHappy:+3, inflation:-3, gdp:-2 }, chips:[{label:'Verm√∂gen sichern',type:'pro'},{label:'Inflation‚Üì',type:'pro'},{label:'-Konsum',type:'con'}] }
      }
    },
    {
      id:'weiterbildung', emoji:'üéì', title:'Weiterbildung',
      description:'Investition in Qualifikation sichert Zukunftsjobs. Kurzfristig Zeit und Geld, langfristig Sicherheit.',
      effects:{ employment:+5, gdp:+3, inflation:+1, budget:-2, govHappy:+3, bizHappy:+2, hhHappy:+6 },
      chips:[{label:'+Qualifikation',type:'pro'},{label:'+Jobs',type:'pro'},{label:'langfristig',type:'neu'}],
      tradeoff:false,
      eventMods:{
        fachkraeftemangel:{ title:'Fachkraft werden ‚Äì Nachfrage da', effectMod:{ employment:+5, hhHappy:+4, bizHappy:+3 }, chips:[{label:'Marktl√ºcke nutzen',type:'pro'},{label:'+Einkommen',type:'pro'},{label:'+Jobs',type:'pro'}] },
        automation:{ title:'KI-Kompetenz erwerben', effectMod:{ employment:+4, hhHappy:+4, gdp:+2 }, chips:[{label:'Job zukunftssicher',type:'pro'},{label:'+Chancen',type:'pro'},{label:'Zeit n√∂tig',type:'neu'}] }
      }
    },
    {
      id:'streik', emoji:'‚úä', title:'Streik & Protest',
      description:'Lohndruck erzeugen. Harter Weg, aber wirksam ‚Äì wenn Solidarit√§t h√§lt. Wirtschaft leidet kurzfristig.',
      effects:{ employment:-4, gdp:-6, inflation:+2, budget:-3, govHappy:-6, bizHappy:-8, hhHappy:+7 },
      chips:[{label:'+Lohndruck',type:'pro'},{label:'-BIP stark',type:'con'},{label:'-Sozialfrieden',type:'con'}],
      tradeoff:true,
      eventMods:{
        inflation_spike:{ title:'Generalstreik gegen Kaufkraftverlust', effectMod:{ hhHappy:+5, bizHappy:-4, inflation:+2, govHappy:-4 }, chips:[{label:'Druck machen',type:'pro'},{label:'+Inflation',type:'con'},{label:'-Wirtschaft',type:'con'}] },
        automation:{ title:'Streik gegen Automatisierungswelle', effectMod:{ employment:+2, hhHappy:+4, bizHappy:-4 }, chips:[{label:'Jobs verteidigen',type:'pro'},{label:'Investoren‚Üì',type:'con'},{label:'+Solidarit√§t',type:'neu'}] }
      }
    }
  ]
};

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// AI COMMENTS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const AI_COMMENTS = {
  gov:{
    good:["Die Zahlen stimmen uns vorsichtig optimistisch.","Deutschland zeigt St√§rke in schwierigen Zeiten.","Unser Kurs tr√§gt erste Fr√ºchte.","Wachstum und Stabilit√§t schlie√üen sich nicht aus."],
    neutral:["Wir m√ºssen Wachstum und Stabilit√§t ausbalancieren.","Die Lage bleibt angespannt ‚Äì wir handeln besonnen.","Jede Entscheidung hat ihren Preis. Wir tragen Verantwortung."],
    bad:["Diese Situation bereitet uns ernsthafte Sorgen.","Wir stehen vor harten Entscheidungen f√ºr dieses Land.","Die Haushaltslage l√§sst wenig Spielraum.","Keine einfachen L√∂sungen ‚Äì aber wir handeln."]
  },
  biz:{
    good:["Starke Zahlen. So geht Wirtschaftsstandort Deutschland.","Wir investieren ‚Äì die Bedingungen stimmen.","AutoNova w√§chst. Das nutzt allen."],
    neutral:["Steigende Kosten gef√§hrden unsere Wettbewerbsf√§higkeit.","Wir investieren ‚Äì aber nur bei stabilen Bedingungen.","Regulierung und B√ºrokratie kosten uns Effizienz."],
    bad:["Wir √ºberpr√ºfen unseren Standort in Deutschland.","Diese Rahmenbedingungen sind f√ºr uns nicht tragbar.","Wenn sich nichts √§ndert, m√ºssen wir Konsequenzen ziehen."]
  },
  hh:{
    good:["Endlich ‚Äì die Lage bessert sich sp√ºrbar!","Mehr Jobs, mehr Sicherheit. Das gibt Hoffnung.","Wir k√∂nnen wieder in die Zukunft planen."],
    neutral:["Die Preise machen uns Sorgen.","Mehr Jobs sind gut, aber die Miete steigt weiter.","Wir kommen durch ‚Äì aber einfach ist es nicht."],
    bad:["So kann es nicht weitergehen. Wir leiden.","Die kleinen Leute bezahlen immer den Preis.","Wir brauchen Entlastung ‚Äì sofort!"]
  }
};

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// GAME STATE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let state = {};
let usedEvents = [];
let selectedDecision = null;
let roundHistory = [];
let mobileTab = 'center';

function initState(role) {
  state = {
    role, round: 1, maxRounds: 12, phase: 'decide',
    employment: 58, gdp: 50, inflation: 46, budget: 52,
    govHappy: 50, bizHappy: 46, hhHappy: 48,
    prev:{ employment:58, gdp:50, inflation:46, budget:52, govHappy:50, bizHappy:46, hhHappy:48 },
    bizArchetype: Math.random() < .5 ? 'kostenfuchs' : 'expansiv',
    hhArchetype:  Math.random() < .5 ? 'sicherheit'  : 'aufstieg',
    govLastAction:null, bizLastAction:null, hhLastAction:null,
    currentEvent:null, currentDecisions:[], lastReport:null
  };
  usedEvents=[]; selectedDecision=null; roundHistory=[];
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// HELPERS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function clamp(v){ return Math.max(0,Math.min(100,Math.round(v))); }
function getMood(h){ return h>=75?2:h>=55?1:h>=40?0:h>=25?-1:-2; }
function getMoodStars(m){
  let s='';
  for(let i=-2;i<=2;i++) s+=`<span class="mood-star ${i<=m?'active':''}">‚òÖ</span>`;
  return s;
}
function getComment(a,h){
  const arr=h>=60?AI_COMMENTS[a].good:h>=40?AI_COMMENTS[a].neutral:AI_COMMENTS[a].bad;
  return arr[Math.floor(Math.random()*arr.length)];
}
function getEvent(){
  const avail=EVENTS.filter(e=>!usedEvents.includes(e.id));
  if(avail.length===0){ usedEvents=[]; return getEvent(); }
  const e=avail[Math.floor(Math.random()*avail.length)];
  usedEvents.push(e.id); return e;
}
function applyEffects(effects,factor=1){
  for(const[k,v] of Object.entries(effects)){
    if(Object.prototype.hasOwnProperty.call(state,k)) state[k]=clamp(state[k]+v*factor);
  }
}
function getStabilityIndex(){
  const s=(state.employment+state.budget+(100-state.inflation)+(state.govHappy+state.bizHappy+state.hhHappy)/3)/4;
  return clamp(s);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// BUILD DECISIONS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildDecisions(role,event){
  return DECISION_TEMPLATES[role].map(tmpl=>{
    const eid=event?event.id:null;
    const mod=eid&&tmpl.eventMods&&tmpl.eventMods[eid];
    let title,description,chips,effectMod;
    if(mod){
      title=mod.title; description=mod.description||tmpl.description;
      chips=mod.chips; effectMod=mod.effectMod||{};
    } else {
      const evtShort=event?event.title.replace(/^\S+\s*/,''):'';
      title=evtShort?`${tmpl.title} ‚Äì bei ${evtShort}`:tmpl.title;
      description=tmpl.description; chips=tmpl.chips;
      effectMod=autoEffectMod(tmpl,event);
    }
    const mergedEffects={...tmpl.effects};
    for(const[k,v] of Object.entries(effectMod)) mergedEffects[k]=(mergedEffects[k]||0)+v;
    return{...tmpl,title,description,effects:mergedEffects,chips,isContextual:!!mod};
  });
}

function autoEffectMod(tmpl,event){
  if(!event) return{};
  const mod={}; const eid=event.id;
  if(eid==='energy')          mod.inflation=(tmpl.effects.inflation||0)>0?+2:-2;
  if(eid==='rezession')       { mod.gdp=-3; mod.employment=(tmpl.effects.employment||0)<0?-2:+1; }
  if(eid==='exportboom')      { mod.gdp=+3; mod.employment=+2; }
  if(eid==='inflation_spike') { mod.inflation=+3; mod.hhHappy=-2; }
  if(eid==='automation')      { mod.employment=(tmpl.effects.employment||0)<0?-2:+1; mod.gdp=+2; }
  if(eid==='fachkraeftemangel') mod.employment=+2;
  if(eid==='lieferkette')     { mod.gdp=-2; mod.inflation=+2; }
  if(eid==='techboom')        { mod.gdp=+3; mod.bizHappy=+2; }
  if(eid==='handel')          { mod.gdp=-2; mod.employment=-1; }
  if(eid==='grossinvestor')   { mod.gdp=+2; mod.employment=+2; }
  return mod;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// AI LOGIC
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function aiDecideGov(actions){
  actions=actions||buildDecisions('gov',state.currentEvent);
  let chosen;
  if(state.budget<38)       chosen=actions.find(a=>a.id==='buerokratie');
  else if(state.employment<50) chosen=actions.find(a=>a.id==='infra');
  else if(state.govHappy<42)   chosen=actions.find(a=>a.id==='sozial');
  else { const s=[...actions].sort((a,b)=>(b.effects.govHappy||0)-(a.effects.govHappy||0)); chosen=Math.random()<.2?s[1]:s[0]; }
  if(state.govHappy<35&&Math.random()<.35) chosen=actions.find(a=>a.id==='sozial')||chosen;
  return chosen||actions[0];
}
function aiDecideBiz(actions){
  actions=actions||buildDecisions('biz',state.currentEvent);
  let chosen;
  if(state.bizHappy<35&&Math.random()<.35){ chosen=Math.random()<.5?actions.find(a=>a.id==='verlagerung'):actions.find(a=>a.id==='automatisieren'); return chosen; }
  if(state.bizArchetype==='kostenfuchs'){
    chosen=state.gdp<50?actions.find(a=>a.id==='automatisieren'):(Math.random()<.5?actions.find(a=>a.id==='automatisieren'):actions.find(a=>a.id==='forschung'));
  } else {
    chosen=state.employment<55?actions.find(a=>a.id==='neue_fabrik'):(Math.random()<.6?actions.find(a=>a.id==='forschung'):actions.find(a=>a.id==='neue_fabrik'));
  }
  if(Math.random()<.15){ const all=actions.filter(a=>a!==chosen); chosen=all[Math.floor(Math.random()*all.length)]||chosen; }
  return chosen||actions[0];
}
function aiDecideHh(actions){
  actions=actions||buildDecisions('hh',state.currentEvent);
  let chosen;
  if(state.hhHappy<35&&Math.random()<.35){ return actions.find(a=>a.id==='streik'); }
  if(state.hhArchetype==='sicherheit'){
    chosen=(state.inflation>55||state.employment<50)?actions.find(a=>a.id==='sparen'):actions.find(a=>a.id==='weiterbildung');
  } else {
    chosen=state.employment>60?actions.find(a=>a.id==='konsum'):actions.find(a=>a.id==='weiterbildung');
  }
  if(Math.random()<.15){ const all=actions.filter(a=>a!==chosen); chosen=all[Math.floor(Math.random()*all.length)]||chosen; }
  return chosen||actions[0];
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// MOMENTUM
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function applyMomentum(){
  const targets={employment:53,gdp:48,inflation:44,budget:50};
  const factor=0.04;
  for(const[key,target] of Object.entries(targets)){
    state[key]=clamp(state[key]+(target-state[key])*factor);
  }
  ['govHappy','bizHappy','hhHappy'].forEach(k=>{
    state[k]=clamp(state[k]+(44-state[k])*0.04);
  });
  if(state.inflation>50){ state.hhHappy=clamp(state.hhHappy-3); state.bizHappy=clamp(state.bizHappy-2); state.budget=clamp(state.budget-1); }
  if(state.inflation>65){ state.budget=clamp(state.budget-3); state.hhHappy=clamp(state.hhHappy-3); state.govHappy=clamp(state.govHappy-2); }
  if(state.employment<50){ state.govHappy=clamp(state.govHappy-5); state.hhHappy=clamp(state.hhHappy-5); state.bizHappy=clamp(state.bizHappy-3); state.gdp=clamp(state.gdp-2); }
  if(state.budget<30){ state.govHappy=clamp(state.govHappy-6); state.bizHappy=clamp(state.bizHappy-3); state.gdp=clamp(state.gdp-3); }
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// WIN / LOSE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function checkGameOver(){
  const stab=getStabilityIndex();
  if(stab<20) return{end:true,win:false,reason:'Der Stabilit√§tsindex ist auf '+stab+' gefallen. Deutschland steckt in einer tiefen Systemkrise.'};
  if(state.employment<15) return{end:true,win:false,reason:'Die Arbeitslosigkeit hat ein katastrophales Niveau erreicht. Sozialer Zusammenhalt kollabiert.'};
  if(state.budget<10) return{end:true,win:false,reason:'Der Staatshaushalt ist zusammengebrochen. Keine Handlungsf√§higkeit mehr.'};
  if(state.round>state.maxRounds){
    const r=state.role;
    let win=false;
    if(r==='gov') win=state.employment>=72&&state.budget>=60&&[state.govHappy,state.bizHappy,state.hhHappy].filter(h=>h>=60).length>=2;
    if(r==='biz') win=state.bizHappy>=78&&state.employment>=50&&state.budget>=45;
    if(r==='hh')  { const kk=clamp(state.gdp-Math.floor(state.inflation/2)); win=state.hhHappy>=72&&kk>=52&&state.employment>=58; }
    const reason=win?winReason(r):loseReason(r);
    return{end:true,win,reason};
  }
  return{end:false};
}

function winReason(r){
  if(r==='gov') return 'Du hast Deutschland durch turbulente Zeiten gef√ºhrt. Besch√§ftigung, Budget und Zufriedenheit stimmen ‚Äì politische Stabilit√§t erreicht.';
  if(r==='biz') return 'AutoNova AG hat die Krise navigiert und bleibt profitabel. Deutschland beh√§lt seinen Industrie-Anker.';
  return 'Familie Schneider hat Kaufkraft, Job und Lebensqualit√§t gesichert. Der Mittelstand h√§lt stand.';
}
function loseReason(r){
  if(r==='gov') return 'Die Zielwerte konnten nicht gehalten werden. Deutschland braucht eine neue Regierung.';
  if(r==='biz') return 'AutoNova AG verfehlt die wirtschaftlichen Ziele. Der Standort Deutschland ger√§t unter Druck.';
  return 'Familie Schneider hat Kaufkraft oder Jobsicherheit verloren. Der Abstieg war nicht aufzuhalten.';
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// RENDER KPIs
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getRoleKPIs(role){
  if(role==='gov') return [
    {key:'employment',label:'‚öôÔ∏è Besch√§ftigung',   color:'c-employment',bar:'bar-employment',tip:'Anteil der Bev√∂lkerung in Arbeit (0‚Äì100). Unter 30 ‚Üí Systemkollaps. Ziel als Kanzler: ‚â• 72.',dangerHigh:false,crisis:30},
    {key:'gdp',       label:'üìà BIP-Wachstum',     color:'c-gdp',       bar:'bar-gdp',       tip:'Wirtschaftsleistung des Landes. Hoher Wert = wachsende Wirtschaft. Steht f√ºr Produktivit√§t und Exporte.',dangerHigh:false,crisis:null},
    {key:'inflation', label:'üî• Inflation',         color:'c-inflation', bar:'bar-inflation', tip:'Preissteigerungsrate. √úber 65 ‚Üí Budget kollabiert, Haushalte verarmen. Unter 40 = gesund.',dangerHigh:true,crisis:65},
    {key:'budget',    label:'üí∞ Budgetstabilit√§t',  color:'c-budget',    bar:'bar-budget',    tip:'Staatsfinanzen. Unter 25 ‚Üí Staatskrise. Als Kanzler Ziel: ‚â• 60.',dangerHigh:false,crisis:25}
  ];
  if(role==='biz') return [
    {key:'bizHappy',  label:'üíπ Unternehmensgewinn',color:'c-biz',       bar:'bar-biz',       tip:'Marge und Wettbewerbsf√§higkeit. Dein Hauptziel: ‚â• 78.',dangerHigh:false,crisis:22},
    {key:'gdp',       label:'üìà Marktwachstum',     color:'c-gdp',       bar:'bar-gdp',       tip:'Wirtschaftsdynamik ‚Äì dein Markt. Sinkt BIP, schrumpft dein Absatz.',dangerHigh:false,crisis:null},
    {key:'employment',label:'üë∑ Belegschaft',        color:'c-employment',bar:'bar-employment',tip:'Jobmarkt in Deutschland. Ziel: ‚â• 50 ‚Äì zu viel Arbeitslosigkeit schadet dem Absatzmarkt.',dangerHigh:false,crisis:32},
    {key:'budget',    label:'üèõÔ∏è Staatsrahmen',       color:'c-budget',    bar:'bar-budget',    tip:'Staatliche Stabilit√§t beeinflusst dein Gesch√§ftsumfeld. Ziel: ‚â• 45.',dangerHigh:false,crisis:27}
  ];
  return [
    {key:'hhHappy',   label:'üòä Familienwohl',      color:'c-hh',        bar:'bar-hh',        tip:'Lebensqualit√§t deiner Familie. Dein Hauptziel: ‚â• 72.',dangerHigh:false,crisis:22},
    {key:'_kaufkraft',label:'üí≥ Kaufkraft',          color:'c-employment',bar:'bar-kaufkraft', tip:'Realeinkommen = BIP minus halbe Inflation. Ziel: ‚â• 52. Hohe Inflation frisst dein Einkommen.',dangerHigh:false,crisis:null},
    {key:'employment',label:'üîí Jobsicherheit',     color:'c-gdp',       bar:'bar-gdp',       tip:'Arbeitsmarktlage. Dein Ziel: ‚â• 58. Hohe Besch√§ftigung = bessere Verhandlungsposition.',dangerHigh:false,crisis:32},
    {key:'inflation', label:'üí∏ Preissteigerung',   color:'c-inflation', bar:'bar-inflation', tip:'Je h√∂her die Inflation, desto weniger kannst du dir leisten. Unter 40 = gut f√ºr dich.',dangerHigh:true,crisis:65}
  ];
}

function getKpiVal(key){ if(key==='_kaufkraft') return clamp(state.gdp-Math.floor(state.inflation/2)); return state[key]||0; }

function renderKPIs(){
  ['employment','gdp','inflation','budget','govHappy','bizHappy','hhHappy'].forEach(k=>{
    const el=document.getElementById('val-'+k);
    if(el) el.textContent=state[k];
  });
  const role=state.role||'gov';
  const kpis=getRoleKPIs(role);
  const titles={gov:'üèõÔ∏è Deutschland Status',biz:'üè≠ AutoNova AG',hh:'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familie Schneider'};
  const titleEl=document.getElementById('leftPanelTitle');
  if(titleEl) titleEl.textContent=titles[role];
  const grid=document.getElementById('kpiGrid');
  if(!grid) return;
  grid.innerHTML=kpis.map(kpi=>{
    const val=getKpiVal(kpi.key);
    const prevVal=kpi.key==='_kaufkraft'?clamp((state.prev.gdp||state.gdp)-Math.floor((state.prev.inflation||state.inflation)/2)):(state.prev[kpi.key]!==undefined?state.prev[kpi.key]:val);
    const diff=val-prevVal;
    const diffStr=diff>=0?'+'+diff:''+diff;
    const diffCls=diff>0?'pos':diff<0?'neg':'neu';
    let valCls='';
    if(kpi.dangerHigh) valCls=(kpi.crisis&&val>=kpi.crisis)?'val-danger':val>=55?'val-warn':'val-ok';
    else valCls=(kpi.crisis&&val<=kpi.crisis)?'val-danger':val<=45?'val-warn':'val-ok';
    return`<div class="kpi-card">
      <div class="kpi-header">
        <div class="kpi-name ${kpi.color}">${kpi.label}</div>
        <div>
          <span class="kpi-value ${kpi.color} ${valCls}">${val}</span>
          <span class="kpi-delta ${diffCls}">${diffStr}</span>
        </div>
      </div>
      <div class="kpi-bar-bg"><div class="kpi-bar ${kpi.bar}" style="width:${val}%"></div></div>
      <div class="kpi-tooltip">${kpi.tip}</div>
    </div>`;
  }).join('');

  ['gov','biz','hh'].forEach(a=>{
    const el=document.getElementById(a+'Mood');
    if(el) el.innerHTML=getMoodStars(getMood(state[a+'Happy']));
    const barEl=document.getElementById('bar-'+a+'Happy');
    if(barEl) barEl.style.width=state[a+'Happy']+'%';
    const valEl=document.getElementById('val-'+a+'Happy2');
    if(valEl) valEl.textContent=state[a+'Happy'];
  });

  const stab=getStabilityIndex();
  const stabVal=document.getElementById('stabVal');
  if(stabVal){ stabVal.textContent=stab; stabVal.style.color=stab>=65?'var(--neon-green)':stab>=48?'var(--neon-amber)':'var(--neon-red)'; }
  const stabDot=document.getElementById('stabDot');
  if(stabDot) stabDot.className='stab-dot'+(stab<40?' danger':stab<55?' warn':'');
  const stabLabel=document.getElementById('stabLabel');
  if(stabLabel) stabLabel.textContent=stab>=65?'Stabil':stab>=48?'Angespannt':'Kritisch';
  const rb=document.getElementById('roundBadge');
  if(rb) rb.textContent=`Runde ${state.round} / ${state.maxRounds}`;
  const pr=document.getElementById('phaseRow');
  if(pr){
    pr.innerHTML='';
    for(let i=1;i<=state.maxRounds;i++){
      const d=document.createElement('div');
      d.className='phase-dot'+(i<state.round?' done':i===state.round?' active':'');
      pr.appendChild(d);
    }
  }
}

function renderEvent(event){
  document.getElementById('eventTitle').textContent=event.title;
  document.getElementById('eventDesc').textContent=event.description;
  document.getElementById('eventTag').textContent=`Runde ${state.round} ¬∑ Ereignis`;
  const impactEl=document.getElementById('eventImpact');
  if(impactEl&&event.impactLabels){
    impactEl.innerHTML=event.impactLabels.map(l=>{
      const cls=l.startsWith('+')?'impact-pos':l.startsWith('-')?'impact-neg':'impact-neu';
      return`<span class="impact-chip ${cls}">${l}</span>`;
    }).join('');
  }
}

function renderDecisions(){
  const grid=document.getElementById('decisionsGrid');
  grid.innerHTML='';
  state.currentDecisions.forEach(d=>{
    const card=document.createElement('div');
    card.className='decision-card';
    card.dataset.id=d.id;
    const chips=d.chips.map(c=>`<span class="chip ${c.type}">${c.label}</span>`).join('');
    const badge=d.tradeoff?`<span class="tradeoff-badge">ABW√ÑGUNG</span>`:'';
    card.innerHTML=`
      ${badge}
      <span class="decision-emoji">${d.emoji}</span>
      <div class="decision-title">${d.title}</div>
      <div class="decision-desc">${d.description||''}</div>
      <div class="effect-chips">${chips}</div>`;
    card.addEventListener('click',()=>selectDecision(d.id));
    grid.appendChild(card);
  });
}

function selectDecision(id){
  if(state.phase!=='decide') return;
  selectedDecision=id;
  document.querySelectorAll('.decision-card').forEach(c=>{
    c.classList.remove('selected');
    if(c.dataset.id===id) c.classList.add('selected');
  });
  setTimeout(processRound,600);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// PROCESS ROUND
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function processRound(){
  if(!selectedDecision||state.phase!=='decide') return;
  state.phase='report';
  document.querySelectorAll('.decision-card').forEach(c=>c.classList.add('disabled'));
  state.prev={employment:state.employment,gdp:state.gdp,inflation:state.inflation,budget:state.budget,govHappy:state.govHappy,bizHappy:state.bizHappy,hhHappy:state.hhHappy};
  const event=state.currentEvent;
  const playerDecision=state.currentDecisions.find(d=>d.id===selectedDecision);
  if(!playerDecision){ state.phase='decide'; return; }

  applyEffects(event.baseEffects);

  let bonusEvent=null;
  if(Math.random()<.25){
    bonusEvent=getEvent();
    applyEffects(bonusEvent.baseEffects,.5);
  }
  applyEffects(playerDecision.effects);

  const aiActions=[];
  ['gov','biz','hh'].forEach(r=>{
    if(r===state.role) return;
    const aiDecisions=buildDecisions(r,event);
    let aiDecision=null;
    if(r==='gov') aiDecision=aiDecideGov(aiDecisions);
    if(r==='biz') aiDecision=aiDecideBiz(aiDecisions);
    if(r==='hh')  aiDecision=aiDecideHh(aiDecisions);
    if(aiDecision){
      applyEffects(aiDecision.effects,.7);
      const names={gov:'Bundesregierung',biz:'AutoNova AG',hh:'Familie Schneider'};
      aiActions.push({actor:names[r],action:aiDecision.title,comment:getComment(r,state[r+'Happy'])});
    }
  });

  applyMomentum();

  const changes={};
  ['employment','gdp','inflation','budget','govHappy','bizHappy','hhHappy'].forEach(k=>{
    changes[k]=state[k]-state.prev[k];
  });
  state.lastReport={changes,aiActions,bonusEvent,decision:playerDecision};

  roundHistory.push({round:state.round,event:event.title.replace(/^\S+\s*/,''),decision:playerDecision.title});

  renderKPIs();
  renderReport();
  renderActorComments();
  renderWinConditions();
  renderTimeline();

  setTimeout(()=>{
    const result=checkGameOver();
    if(result.end){
      showEndScreen(result.win,result.reason);
    } else {
      const warnings=[];
      if(state.employment<45) warnings.push('Besch√§ftigung kritisch!');
      if(state.budget<35)     warnings.push('Budget gef√§hrdet!');
      if(state.hhHappy<30)    warnings.push('Soziale Spannungen!');
      if(state.bizHappy<30)   warnings.push('Kapitalflucht droht!');
      if(warnings.length>0) showCrisis(warnings[0]);
    }
  },500);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// RENDER REPORT
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderReport(){
  const report=state.lastReport;
  if(!report) return;
  const grid=document.getElementById('reportGrid');
  const keys=[
    ['employment','Besch√§ftigung'],['gdp','BIP-Wachstum'],['inflation','Inflation'],
    ['budget','Budget'],['govHappy','Regierung'],['bizHappy','Unternehmen'],['hhHappy','Haushalte']
  ];
  grid.innerHTML=keys.map(([k,label])=>{
    const chg=report.changes[k]||0;
    const cls=chg>0?'pos':chg<0?'neg':'neu';
    return`<div class="report-item"><span class="report-key">${label}</span><span class="report-chg ${cls}">${chg>0?'+':''}${chg}</span></div>`;
  }).join('');

  // Insight text ‚Äì pedagogical feedback
  const insight=generateInsight(report);
  const insightEl=document.getElementById('reportInsight');
  if(insightEl) insightEl.innerHTML=insight;

  const bonusEl=document.getElementById('bonusEventNotice');
  if(bonusEl){
    if(report.bonusEvent){ bonusEl.style.display='block'; bonusEl.innerHTML=`‚ö° <strong>√úberraschungsereignis:</strong> ${report.bonusEvent.title} <span style="color:var(--text3)">(halbe St√§rke)</span>`; }
    else bonusEl.style.display='none';
  }

  const aiLog=document.getElementById('aiActionsLog');
  if(report.aiActions.length===0){
    aiLog.innerHTML='<em style="color:var(--text3)">Keine KI-Aktionen diese Runde.</em>';
  } else {
    aiLog.innerHTML=report.aiActions.map(a=>
      `<div class="ai-action-entry">ü§ñ <strong>${a.actor}:</strong> ${a.action} ‚Äî <em style="color:var(--text2)">${a.comment}</em></div>`
    ).join('');
    aiLog.querySelectorAll('.ai-action-entry').forEach((el,i)=>setTimeout(()=>el.style.opacity='1',i*320+100));
  }

  document.getElementById('reportPanel').classList.add('visible');
}

function generateInsight(report){
  const chg=report.changes;
  const lines=[];
  if(chg.inflation>5) lines.push(`<strong>Achtung Inflation:</strong> +${chg.inflation} Punkte ‚Äì das belastet Kaufkraft und Haushalte direkt.`);
  if(chg.employment<-4) lines.push(`<strong>Jobverlust:</strong> ${chg.employment} Besch√§ftigung. Das senkt Steuereinnahmen und Konsum gleichzeitig.`);
  if(chg.employment>6) lines.push(`<strong>Besch√§ftigungsschub:</strong> +${chg.employment} ‚Äì mehr Jobs = mehr Kaufkraft = mehr BIP. Der Multiplikatoreffekt.`);
  if(chg.budget<-6) lines.push(`<strong>Budgetdruck:</strong> ${chg.budget} Budget. Haushaltsdefizite schr√§nken zuk√ºnftigen Handlungsspielraum ein.`);
  if(chg.bizHappy<-5&&chg.hhHappy>3) lines.push(`<strong>Verteilungskonflikt:</strong> Was Haushalte gewinnen, verlieren Unternehmen ‚Äì klassischer Trade-off zwischen Lohnkosten und Sozialleistungen.`);
  if(chg.gdp>5&&chg.inflation>4) lines.push(`<strong>Wachstum mit Risiko:</strong> +${chg.gdp} BIP, aber +${chg.inflation} Inflation. Zu schnelles Wachstum kann √ºberhitzen.`);
  if(report.bonusEvent) lines.push(`<strong>√úberraschungsereignis:</strong> "${report.bonusEvent.title}" traf zus√§tzlich ein. Wirtschaft ist nie vollst√§ndig kontrollierbar.`);
  if(lines.length===0) lines.push(`<strong>Ruhige Runde:</strong> Die Wirkungen der Entscheidung waren moderat. Manchmal ist Stabilit√§t halten das Beste, was man tun kann.`);
  return lines.join('<br>');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// ACTOR COMMENTS (typing effect)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderActorComments(){
  ['gov','biz','hh'].forEach(a=>{
    const el=document.getElementById('speech-'+a);
    if(!el) return;
    el.textContent=''; el.classList.add('typing');
    const msg=getComment(a,state[a+'Happy']);
    let i=0;
    const interval=setInterval(()=>{
      el.textContent+=msg[i]; i++;
      if(i>=msg.length){ clearInterval(interval); el.classList.remove('typing'); }
    },26);
  });
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// WIN CONDITIONS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function winBar(label,val,target,color,invert){
  const done=invert?val<=target:val>=target;
  const pct=invert?Math.min(100,Math.max(0,Math.round((target/Math.max(val,1))*100))):Math.min(100,Math.round((val/target)*100));
  const cls=done?'done':val<=(invert?target*1.3:target*0.55)?'danger':'';
  const barColor=done?'var(--neon-green)':cls==='danger'?'var(--neon-red)':'var(--neon-amber)';
  const icon=done?'‚úÖ':cls==='danger'?'üî¥':'üü°';
  const diffStr=invert?(val<=target?'‚úì':`‚àí${val-target} zu hoch`):(val>=target?'‚úì':`+${target-val} fehlt`);
  return`<div class="win-cond-item ${cls}">
    <div class="win-cond-header">
      <div class="win-cond-label">${icon} ${label}</div>
      <div class="win-cond-vals" style="color:${barColor}">${val} ${invert?'‚â§':'/'} ${target} <span style="color:var(--text3);font-size:0.68rem">${diffStr}</span></div>
    </div>
    <div class="win-cond-track"><div class="win-cond-fill" style="width:${pct}%;background:${barColor}"></div></div>
  </div>`;
}

function renderWinConditions(){
  const r=state.role; let html='';
  if(r==='gov'){
    const h2=[state.govHappy,state.bizHappy,state.hhHappy].filter(h=>h>=60).length;
    html+=winBar('Besch√§ftigung',state.employment,72,'green',false);
    html+=winBar('Budgetstabilit√§t',state.budget,60,'purple',false);
    html+=`<div class="win-cond-item ${h2>=2?'done':h2===0?'danger':''}">
      <div class="win-cond-header">
        <div class="win-cond-label">${h2>=2?'‚úÖ':h2===0?'üî¥':'üü°'} Min. 2 Akteure zufrieden ‚â•60</div>
        <div class="win-cond-vals" style="color:${h2>=2?'var(--neon-green)':'var(--neon-amber)'}">${h2}/3 erf√ºllt</div>
      </div>
      <div class="win-cond-track"><div class="win-cond-fill" style="width:${Math.round(h2/2*100)}%;background:${h2>=2?'var(--neon-green)':'var(--neon-amber)'}"></div></div>
    </div>`;
  } else if(r==='biz'){
    html+=winBar('Unternehmensgewinn',state.bizHappy,78,'amber',false);
    html+=winBar('Belegschaft (Besch√§ftigung)',state.employment,50,'green',false);
    html+=winBar('Staatsrahmen (Budget)',state.budget,45,'purple',false);
  } else {
    const kk=clamp(state.gdp-Math.floor(state.inflation/2));
    html+=winBar('Familienwohl',state.hhHappy,72,'hh',false);
    html+=winBar('Kaufkraft (BIP ‚àí ¬Ω Inflation)',kk,52,'kaufkraft',false);
    html+=winBar('Jobsicherheit (Besch√§ftigung)',state.employment,58,'jobsicher',false);
  }
  document.getElementById('winCondPanel').innerHTML=html;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// TIMELINE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderTimeline(){
  const tl=document.getElementById('timeline');
  if(!tl||roundHistory.length===0) return;
  tl.innerHTML=roundHistory.slice().reverse().map(h=>
    `<div class="timeline-entry">
      <span class="timeline-rnd">R${h.round}</span>
      <span class="timeline-event">${h.event}</span>
      <span class="timeline-decision">¬∑ ${h.decision}</span>
    </div>`
  ).join('');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// NEXT ROUND
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function nextRound(){
  state.round++;
  state.phase='decide';
  selectedDecision=null;
  const result=checkGameOver();
  if(result.end){ showEndScreen(result.win,result.reason); return; }
  state.currentEvent=getEvent();
  state.currentDecisions=buildDecisions(state.role,state.currentEvent);
  document.getElementById('reportPanel').classList.remove('visible');
  document.getElementById('bonusEventNotice').style.display='none';
  renderEvent(state.currentEvent);
  renderDecisions();
  renderKPIs();
  renderWinConditions();
  renderTimeline();
  const cc=document.getElementById('centerCol');
  if(cc) cc.scrollTop=0;
  window.scrollTo({top:0,behavior:'smooth'});
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// CRISIS BANNER
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showCrisis(msg){
  const b=document.getElementById('crisisBanner');
  b.textContent='‚ö†Ô∏è '+msg; b.classList.add('show');
  setTimeout(()=>b.classList.remove('show'),3500);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// END SCREEN + PEDAGOGICAL FEEDBACK
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showEndScreen(win,reason){
  const endScreen=document.getElementById('endScreen');
  document.getElementById('endIcon').textContent=win?'üèÜ':'üíî';
  const titleEl=document.getElementById('endTitle');
  titleEl.textContent=win?'ZIEL ERREICHT!':'NICHT BESTANDEN';
  titleEl.className='end-title '+(win?'win':'lose');
  document.getElementById('endReason').textContent=reason;
  const roleNames={gov:'Kanzler ¬∑ Friedrich Merz',biz:'AutoNova AG',hh:'Familie Schneider'};
  const kk=clamp(state.gdp-Math.floor(state.inflation/2));
  const stab=getStabilityIndex();
  document.getElementById('endStats').innerHTML=`
    <div class="end-stat-row"><span class="end-stat-key">Rolle</span><span class="end-stat-val">${roleNames[state.role]}</span></div>
    <div class="end-stat-row"><span class="end-stat-key">Runden gespielt</span><span class="end-stat-val">${state.round-1} / 12</span></div>
    <div class="end-stat-row"><span class="end-stat-key">Besch√§ftigung</span><span class="end-stat-val" style="color:var(--neon-green)">${state.employment}</span></div>
    <div class="end-stat-row"><span class="end-stat-key">BIP-Wachstum</span><span class="end-stat-val" style="color:var(--neon-blue)">${state.gdp}</span></div>
    <div class="end-stat-row"><span class="end-stat-key">Inflation</span><span class="end-stat-val" style="color:var(--neon-amber)">${state.inflation}</span></div>
    <div class="end-stat-row"><span class="end-stat-key">Budgetstabilit√§t</span><span class="end-stat-val" style="color:var(--neon-purple)">${state.budget}</span></div>
    <div class="end-stat-row"><span class="end-stat-key">Kaufkraft (Haushalte)</span><span class="end-stat-val" style="color:var(--hh-color)">${kk}</span></div>
    <div class="end-stat-row"><span class="end-stat-key">Stabilit√§tsindex</span><span class="end-stat-val">${stab}</span></div>`;
  document.getElementById('feedbackItems').innerHTML=generateFeedback();
  document.getElementById('gameScreen').classList.remove('active');
  endScreen.classList.add('active');
}

function generateFeedback(){
  const lines=[];
  if(state.inflation>60) lines.push('Hohe Inflation ('+state.inflation+') hat die Kaufkraft massiv gesenkt. In der Realit√§t k√§mpft die Zentralbank mit Zinserh√∂hungen dagegen an.');
  if(state.employment<50) lines.push('Niedrige Besch√§ftigung ('+state.employment+') kostet Steuereinnahmen und erh√∂ht Sozialausgaben gleichzeitig ‚Äì eine teure Abw√§rtsspirale.');
  if(state.budget<40) lines.push('Budgetdefizite ('+state.budget+') schr√§nken zuk√ºnftige Handlungsspielr√§ume ein. Deutschland hat die "Schuldenbremse" genau f√ºr solche Situationen.');
  if(state.bizHappy<40) lines.push('Unternehmen unzufrieden ('+state.bizHappy+'): Das kann zu Standortverlagerungen f√ºhren ‚Äì wie im echten Deutschland, wo viele Firmen ins Ausland abwandern.');
  if(state.hhHappy<40) lines.push('Geringe Haushaltszufriedenheit ('+state.hhHappy+'): In der Realit√§t f√ºhrt das zu politischer Unzufriedenheit und Protestw√§hlen.');
  if(state.employment>70) lines.push('Gute Besch√§ftigung ('+state.employment+'): Niedriger Einsatz = mehr Steuereinnahmen + mehr Konsum. Die "doppelte Dividende" des Vollbesch√§ftigung.');
  if(lines.length===0) lines.push('Eine ausgewogene Wirtschaft ist das Ergebnis vieler kleiner, schwieriger Trade-offs ‚Äì genau das hast du navigiert.');
  lines.push('Volkswirtschaften reagieren tr√§ge: Entscheidungen wirken oft erst nach mehreren Runden ‚Äì in der Realit√§t nach Quartalen oder Jahren.');
  return lines.map(l=>`<div class="feedback-item">${l}</div>`).join('');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// NAVIGATION / SCREENS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showTutorial(){
  hideAllScreens();
  document.getElementById('tutorialScreen').classList.add('active');
}
function showIntro(){
  hideAllScreens();
  document.getElementById('introScreen').classList.add('active');
}
function hideAllScreens(){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
}

function startGame(role){
  initState(role);
  const tags={gov:'govPlayerTag',biz:'bizPlayerTag',hh:'hhPlayerTag'};
  Object.entries(tags).forEach(([r,tagId])=>{
    const el=document.getElementById(tagId);
    if(el) el.style.display=r===role?'inline-block':'none';
    const card=document.getElementById('actor'+r.charAt(0).toUpperCase()+r.slice(1));
    if(card){ card.className='actor-card '+r+(r===role?' is-player':''); }
  });
  const ri=document.getElementById('roleIndicator');
  const labels={gov:'üèõÔ∏è Kanzler',biz:'üè≠ AutoNova AG',hh:'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familie Schneider'};
  ri.textContent=labels[role]; ri.className='role-indicator '+role;
  state.currentEvent=getEvent();
  state.currentDecisions=buildDecisions(state.role,state.currentEvent);
  hideAllScreens();
  document.getElementById('gameScreen').classList.add('active');
  renderEvent(state.currentEvent);
  renderDecisions();
  renderKPIs();
  renderWinConditions();
  renderTimeline();
  renderActorComments();
  if(window.innerWidth<=1100) checkLayout();
}

function resetGame(){
  hideAllScreens();
  document.getElementById('introScreen').classList.add('active');
  document.getElementById('reportPanel').classList.remove('visible');
}

function openHelp(){ document.getElementById('helpModal').classList.add('open'); }
function closeHelp(){ document.getElementById('helpModal').classList.remove('open'); }
document.getElementById('helpModal').addEventListener('click',function(e){ if(e.target===this) closeHelp(); });

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// MOBILE TABS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchTab(tab){
  mobileTab=tab;
  document.querySelectorAll('.tab-btn').forEach((b,i)=>b.classList.toggle('active',['center','left','right'][i]===tab));
  const left=document.querySelector('.col-left');
  const center=document.querySelector('.col-center');
  const right=document.querySelector('.col-right');
  if(left)   left.style.display  =tab==='left'  ?'block':'none';
  if(center) center.style.display=tab==='center'?'block':'none';
  if(right)  right.style.display =tab==='right' ?'block':'none';
}
function checkLayout(){
  if(window.innerWidth>1100){
    ['col-left','col-center','col-right'].forEach(c=>{ const el=document.querySelector('.'+c); if(el) el.style.display=''; });
  } else { switchTab(mobileTab); }
}
window.addEventListener('resize',checkLayout);
if(window.innerWidth<=1100) checkLayout();
</script>
</body>
</html>
